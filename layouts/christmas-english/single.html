{{ define "main" }}
<script>
// ç»™bodyæ·»åŠ ç‰¹å®šç±»åä»¥éšè—å¯¼èˆªæ¡
document.body.classList.add('christmas-english-page');
</script>
<h1 class="page-title" id="day-title">Christmas Learning - Day 1!</h1>
<div class="day-description" id="day-description">Learn English with Christmas magic!</div>
<div class="christmas-container">
  
  <div class="learning-sentences" id="learning-sentences">
    <!-- Day 1 content -->
    <div class="sentence-card">
      <div class="sentence-image">
        <svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="150" fill="#FFF8F0"/>
          <rect x="95" y="110" width="10" height="25" fill="#A0826D" rx="2"/>
          <polygon points="100,25 75,55 125,55" fill="#90EE90" rx="5"/>
          <polygon points="100,40 70,75 130,75" fill="#98FB98" rx="5"/>
          <polygon points="100,55 65,95 135,95" fill="#90EE90" rx="5"/>
          <polygon points="100,70 60,115 140,115" fill="#98FB98" rx="5"/>
          <circle cx="85" cy="40" r="2" fill="#FFE4B5" opacity="0.9"/>
          <circle cx="115" cy="35" r="2" fill="#FFE4B5" opacity="0.9"/>
          <circle cx="80" cy="60" r="2" fill="#FFE4B5" opacity="0.9"/>
          <circle cx="120" cy="65" r="2" fill="#FFE4B5" opacity="0.9"/>
          <circle cx="90" cy="80" r="2" fill="#FFE4B5" opacity="0.9"/>
          <circle cx="110" cy="85" r="2" fill="#FFE4B5" opacity="0.9"/>
          <polygon points="100,15 102,20 107,20 103,23 105,28 100,25 95,28 97,23 93,20 98,20" fill="#FFF8DC" opacity="0.8"/>
        </svg>
      </div>
      <div class="sentence-text">It's Christmas.</div>
      <button class="play-button" onclick="playAudio('its-christmas', event)">
        <svg viewBox="0 0 24 24" class="play-icon">
          <polygon points="5,3 19,12 5,21" fill="currentColor"/>
        </svg>
      </button>
    </div>
    
    <div class="sentence-card">
      <div class="sentence-image">
        <svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="150" fill="#FFF8F0"/>
          <polygon points="120,30 105,60 135,60" fill="#90EE90"/>
          <polygon points="120,45 100,80 140,80" fill="#98FB98"/>
          <polygon points="120,60 95,100 145,100" fill="#90EE90"/>
          <rect x="117" y="100" width="6" height="20" fill="#A0826D"/>
          <circle cx="70" cy="65" r="18" fill="#FDBCB4"/>
          <path d="M 55 55 Q 70 45 85 55 Q 85 50 80 48 Q 70 46 60 48 Q 55 50 55 55" fill="#D2691E"/>
          <circle cx="64" cy="62" r="2" fill="#4A4A4A"/>
          <circle cx="76" cy="62" r="2" fill="#4A4A4A"/>
          <path d="M 65 70 Q 70 74 75 70" stroke="#FF6B6B" stroke-width="1.5" fill="none"/>
          <rect x="60" y="80" width="20" height="25" fill="#87CEEB" rx="8"/>
          <ellipse cx="55" cy="88" rx="6" ry="12" fill="#FDBCB4" transform="rotate(-20 55 88)"/>
          <ellipse cx="85" cy="88" rx="6" ry="12" fill="#FDBCB4" transform="rotate(20 85 88)"/>
          <rect x="64" y="102" width="6" height="18" fill="#4169E1" rx="3"/>
          <rect x="70" y="102" width="6" height="18" fill="#4169E1" rx="3"/>
          <circle cx="70" cy="75" r="35" fill="#FFE4B5" opacity="0.2"/>
        </svg>
      </div>
      <div class="sentence-text">I see a Christmas tree.</div>
      <button class="play-button" onclick="playAudio('i-see-christmas-tree', event)">
        <svg viewBox="0 0 24 24" class="play-icon">
          <polygon points="5,3 19,12 5,21" fill="currentColor"/>
        </svg>
      </button>
    </div>
    
    <div class="sentence-card">
      <div class="sentence-image">
        <svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
          <!-- Beautiful Christmas gift box with warm colors - flat cartoon style -->
          <!-- Soft gradient background -->
          <defs>
            <linearGradient id="giftBg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#FFF8F0;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#FFF0E6;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="boxGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#DC143C;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#B22222;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="ribbonGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
            </linearGradient>
          </defs>
          
          <rect width="200" height="150" fill="url(#giftBg)"/>
          
          <!-- Gift box base -->
          <rect x="60" y="85" width="80" height="45" fill="url(#boxGradient)" rx="5"/>
          
          <!-- Gift box lid -->
          <rect x="55" y="65" width="90" height="25" fill="url(#boxGradient)" rx="5"/>
          
          <!-- Golden ribbon vertical -->
          <rect x="95" y="65" width="10" height="65" fill="url(#ribbonGradient)" rx="2"/>
          
          <!-- Golden ribbon horizontal -->
          <rect x="55" y="87" width="90" height="10" fill="url(#ribbonGradient)" rx="2"/>
          
          <!-- Beautiful bow on top -->
          <!-- Left bow loop -->
          <ellipse cx="90" cy="55" rx="12" ry="8" fill="url(#ribbonGradient)" transform="rotate(-20 90 55)"/>
          <!-- Right bow loop -->
          <ellipse cx="110" cy="55" rx="12" ry="8" fill="url(#ribbonGradient)" transform="rotate(20 110 55)"/>
          <!-- Bow center -->
          <ellipse cx="100" cy="58" rx="6" ry="4" fill="#FF8C00"/>
          
          <!-- Gift tag -->
          <rect x="115" y="45" width="25" height="15" fill="#FFFACD" rx="3"/>
          <line x1="120" y1="60" x2="120" y2="70" stroke="#D2691E" stroke-width="1"/>
          <circle cx="122" cy="50" r="1" fill="#DC143C"/>
          <circle cx="127" cy="50" r="1" fill="#DC143C"/>
          <circle cx="122" cy="53" r="1" fill="#DC143C"/>
          <circle cx="127" cy="53" r="1" fill="#DC143C"/>
          
          <!-- Sparkles and magic -->
          <circle cx="40" cy="30" r="2" fill="#FFD700" opacity="0.8"/>
          <circle cx="40" cy="30" r="4" fill="#FFD700" opacity="0.3"/>
          <circle cx="160" cy="25" r="2" fill="#FFD700" opacity="0.8"/>
          <circle cx="160" cy="25" r="4" fill="#FFD700" opacity="0.3"/>
          <circle cx="30" cy="70" r="1.5" fill="#FFA500" opacity="0.7"/>
          <circle cx="170" cy="80" r="1.5" fill="#FFA500" opacity="0.7"/>
          <circle cx="50" cy="120" r="1" fill="#FFD700" opacity="0.6"/>
          <circle cx="150" cy="110" r="1" fill="#FFD700" opacity="0.6"/>
          
          <!-- Soft glow effect -->
          <ellipse cx="100" cy="75" rx="60" ry="30" fill="#FFE4B5" opacity="0.1"/>
        </svg>
      </div>
      <div class="sentence-text">I like Christmas.</div>
      <button class="play-button" onclick="playAudio('i-like-christmas', event)">
        <svg class="play-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Story section - only visible after completing certain days -->
  <div class="story-section" id="story-section" style="display: none;">
    <h2 class="story-title">ğŸ“– Story Time</h2>
    <button class="play-button story-play-circle" onclick="playStory(event)" aria-label="Play Story">
      <svg viewBox="0 0 24 24" class="play-icon">
        <polygon points="5,3 19,12 5,21" fill="currentColor"/>
      </svg>
    </button>
    <div class="story-content" id="story-content"></div>
  </div>
  
  <!-- Navigation buttons -->
  <div class="navigation-buttons">
    <button class="nav-button" id="prev-button" onclick="previousDay(event)" style="display: none;">
      <span class="text">â† Previous Day</span>
    </button>
    <button class="nav-button complete-button" id="complete-button" onclick="completeDay(event)">
      <span class="text">Complete Today's Learning!</span>
    </button>
    <button class="nav-button" id="next-button" onclick="nextDay(event)">
      <span class="text">Next Day â†’</span>
    </button>
  </div>
  

</div>

<style>
/* éšè—åœ£è¯èŠ‚å­¦ä¹ é¡µé¢çš„å¯¼èˆªæ¡ */
body.christmas-english-page header,
body.christmas-english-page nav,
body.christmas-english-page .site-header,
body.christmas-english-page .site-navigation {
  display: none !important;
}

.christmas-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #1E3A8A 0%, #DC2626 50%, #059669 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  box-sizing: border-box;
  font-family: 'Comic Sans MS', cursive, sans-serif;
  position: relative;
  overflow: hidden;
}

.christmas-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="10" cy="10" r="1" fill="white" opacity="0.8"/><circle cx="30" cy="20" r="1" fill="white" opacity="0.6"/><circle cx="50" cy="15" r="1" fill="white" opacity="0.7"/><circle cx="70" cy="25" r="1" fill="white" opacity="0.5"/><circle cx="90" cy="30" r="1" fill="white" opacity="0.9"/><circle cx="20" cy="40" r="1" fill="white" opacity="0.4"/><circle cx="40" cy="35" r="1" fill="white" opacity="0.8"/><circle cx="60" cy="45" r="1" fill="white" opacity="0.6"/><circle cx="80" cy="40" r="1" fill="white" opacity="0.7"/><circle cx="15" cy="60" r="1" fill="white" opacity="0.5"/><circle cx="35" cy="55" r="1" fill="white" opacity="0.9"/><circle cx="55" cy="65" r="1" fill="white" opacity="0.4"/><circle cx="75" cy="60" r="1" fill="white" opacity="0.8"/><circle cx="95" cy="70" r="1" fill="white" opacity="0.6"/><circle cx="25" cy="80" r="1" fill="white" opacity="0.7"/><circle cx="45" cy="85" r="1" fill="white" opacity="0.5"/><circle cx="65" cy="75" r="1" fill="white" opacity="0.9"/><circle cx="85" cy="90" r="1" fill="white" opacity="0.4"/></svg>');
  animation: snowfall 20s linear infinite;
  pointer-events: none;
}

@keyframes snowfall {
  0% { transform: translateY(-100vh); }
  100% { transform: translateY(100vh); }
}

.page-title {
  font-size: 3rem;
  color: #DC2626;
  text-align: center;
  margin-bottom: 1rem;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
  font-weight: bold;
  opacity: 0.95;
  font-family: 'Comic Sans MS', cursive, sans-serif;
  background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient 3s ease infinite;
  letter-spacing: 1px;
}

@keyframes gradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.day-description {
  font-size: 1.2rem;
  color: #FFFFFF;
  text-align: center;
  margin-bottom: 2rem;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  font-weight: 400;
}

.learning-sentences {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-bottom: 2rem;
  align-items: center;
}



.progress-indicator {
  position: relative;
  margin-top: 2rem;
  margin-bottom: 1rem;
  background: rgba(255, 255, 255, 0.9);
  padding: 1rem 2rem;
  border-radius: 25px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
}

.progress-bar {
  width: 200px;
  height: 8px;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #DC2626, #059669);
  border-radius: 4px;
  transition: width 0.3s ease;
  width: 0%;
}

.progress-text {
  text-align: center;
  font-size: 0.9rem;
  color: #333;
  font-weight: 500;
}

.sentence-card {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 25px;
  padding: 1.5rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  width: 380px;
  height: 320px;
  justify-content: center;
  flex-shrink: 0;
}

.sentence-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

.sentence-image {
  width: 200px;
  height: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 15px;
  background: rgba(255, 255, 255, 0.6);
  padding: 10px;
  box-sizing: border-box;
  overflow: hidden;
  position: relative;
}

.sentence-image svg {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
}

.sentence-text {
  font-size: 1.8rem;
  color: #2F4F4F;
  font-weight: 500;
  text-align: center;
  opacity: 0.9;
  letter-spacing: 0.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
}

.play-button {
  background: linear-gradient(135deg, #FFE4B5 0%, #FFF8DC 100%);
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.play-button:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  background: linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
}

.play-button:active {
  transform: scale(0.95);
}

/* Story ä¸“ç”¨åœ†å½¢æ’­æ”¾æŒ‰é’®ï¼Œä¸å¥å­æŒ‰é’®åŒæ¬¾ */
.story-play-circle {
  margin: 0 auto;   /* å±…ä¸­ï¼Œç§»é™¤ä¸‹æ–¹ç•™ç©º */
  background: linear-gradient(135deg, #FFE4B5 0%, #FFF8DC 100%);
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.story-play-circle:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  background: linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
}
.story-play-circle:active {
  transform: scale(0.95);
}

.play-icon {
  width: 24px;
  height: 24px;
  color: #D2691E;
  margin-left: 3px;
}

.day-description {
  text-align: center;
  font-size: 1.2rem;
  color: #059669;
  margin-bottom: 2rem;
  line-height: 1.6;
  opacity: 0.9;
  font-weight: 600;
}

.closing-message {
  font-size: 1.5rem;
  color: #D2691E;
  text-align: center;
  margin-top: 2rem;
  opacity: 0.8;
  font-style: italic;
}

/* Story section */
.story-section {
  background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
  border-radius: 15px;
  padding: 1rem 1rem 0.5rem; /* å‡å°‘åº•éƒ¨å†…è¾¹è· */
  margin: 1.5rem 0;
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  text-align: center;
  backdrop-filter: blur(10px);
  border: 2px solid #B3D9FF;
  max-width: 400px;
  width: 100%;
}

.story-title {
  font-size: 1.5rem;
  color: #2C3E50;
  margin-bottom: 0.8rem;
  font-weight: 500;
}

.story-content {
  font-size: 1.3rem;
  color: #34495E;
  line-height: 2;
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: rgba(255, 248, 240, 0.6);
  border-radius: 15px;
  font-family: 'Comic Sans MS', cursive, sans-serif;
}

.story-play {
  margin: 0 auto;
}

/* ===== åº•éƒ¨ä¸‰é¢—åœ£è¯æŒ‰é’® ===== */
.navigation-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin: 2.5rem 0 2rem;
  flex-wrap: wrap;
  align-items: center;
  perspective: 800px;
}

.nav-button {
  --icon-size: 1.2em;
  position: relative;
  padding: 0.85rem 1.6rem 0.85rem calc(var(--icon-size) + 1.1rem);
  border: none;
  border-radius: 50px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  transition: transform .25s, box-shadow .25s, background .25s;
  box-shadow: 0 6px 16px rgba(0,0,0,.18);
  color: #fff;
  overflow: hidden;
  user-select: none;
  outline: none;
  display: none;                 /* é»˜è®¤éšè—ï¼ŒJS æ§åˆ¶æ˜¾ç¤º */
  transform-style: preserve-3d;
  backface-visibility: hidden;
}
.nav-button::before {            /* å›¾æ ‡ */
  content: '';
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  width: var(--icon-size);
  height: var(--icon-size);
  background: currentColor;
  mask-size: contain;
  mask-repeat: no-repeat;
  mask-position: center;
}
#prev-button::before   { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>'); }
#next-button::before   { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>'); }
.complete-button::before{ mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'); }

/* é›ªèŠ±é£˜è½å¾®åŠ¨ç”» */
@keyframes snowFall {
  0%   { background-position: 0 0, 0 0, 0 0; }
  100% { background-position: 100px 100px, 200px 200px, 300px 300px; }
}
.nav-button::after {             /* é›ªèŠ±å±‚ */
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-image:
    radial-gradient(circle, rgba(255,255,255,.8) 1px, transparent 1px),
    radial-gradient(circle, rgba(255,255,255,.6) 1px, transparent 1px),
    radial-gradient(circle, rgba(255,255,255,.4) 1px, transparent 1px);
  background-size: 60px 60px, 90px 90px, 120px 120px;
  animation: snowFall 4s linear infinite;
  opacity: 0;
  transition: opacity .3s;
}
.nav-button:hover::after { opacity: 1; }

/* æ‚¬åœ & ç‚¹å‡» */
.nav-button:hover:not(:disabled) {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 10px 24px rgba(0,0,0,.25);
}
.nav-button:active {
  transform: translateY(0) scale(.98);
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
}

/* é…è‰² */
#prev-button          { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
#next-button          { background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); }
.complete-button      { background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); color: #2d3436; }

/* ç¦ç”¨æ€ */
.nav-button:disabled {
  background: #dfe6e9;
  color: #b2bec3;
  cursor: not-allowed;
  box-shadow: none;
}
.nav-button:disabled::after { display: none; }

/* å¯è®¿é—®æ€§ */
.nav-button:focus-visible {
  outline: 3px solid #fdcb6e;
  outline-offset: 3px;
}

/* ç§»åŠ¨ç«¯æ¨ªå‘æ’å¸ƒ */
@media (max-width: 768px) {
  .navigation-buttons { flex-wrap: nowrap; }
  .nav-button {
    flex: 1 1 0;
    min-width: 0;
    padding: 0.75rem 0.5rem 0.75rem calc(var(--icon-size) + 0.8rem);
    font-size: 0.9rem;
  }
  .nav-button::before { left: 0.6rem; }
  .nav-button .text { display: none; }   /* åªä¿ç•™å›¾æ ‡ */
}

/* Progress indicator */
.progress-indicator {
  text-align: center;
  margin-top: 2rem;
  margin-bottom: 2rem;
}

.progress-bar {
  width: 200px;
  height: 8px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 4px;
  margin: 0 auto 0.5rem;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #FFE4B5 0%, #D2691E 100%);
  border-radius: 4px;
  transition: width 0.5s ease;
  width: 16.67%;
}

.progress-text {
  font-size: 1rem;
  color: #6B7280;
  opacity: 0.8;
  font-weight: 500;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .learning-sentences {
    flex-direction: column;
    align-items: center;
  }
  
  .page-title {
    font-size: 2rem;
  }
  
  .sentence-text {
    font-size: 1.5rem;
  }
  
  .navigation-buttons {
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }
  
  .nav-button, .complete-button, .play-story-button {
    width: 100%;
    max-width: 300px;
  }
  
  .story-content {
    font-size: 1.1rem;
  }
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes gentleFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-5px); }
}

.sentence-image svg {
  animation: gentleFloat 4s ease-in-out infinite;
}

.sentence-card:nth-child(2) .sentence-image svg {
  animation-delay: 0.5s;
}

.sentence-card:nth-child(3) .sentence-image svg {
  animation-delay: 1s;
}
</style>

<script>
// è·Ÿè¸ªå·²æœ—è¯»çš„å¥å­
let playedSentences = new Set();

// è·å–å½“å‰å¤©çš„æ‰€æœ‰å¥å­ID
function getCurrentDaySentenceIds() {
  const content = christmasContent[currentDay];
  if (!content || !content.sentences) return [];
  return content.sentences.map(sentence => sentence.audio);
}

// æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¥å­éƒ½å·²æœ—è¯»
function checkAllSentencesPlayed() {
  const currentSentenceIds = getCurrentDaySentenceIds();
  const allPlayed = currentSentenceIds.every(id => playedSentences.has(id));
  
  if (allPlayed && currentSentenceIds.length > 0) {
    // æ‰€æœ‰å¥å­éƒ½å·²æœ—è¯»ï¼Œå¯ç”¨å®ŒæˆæŒ‰é’®
    const completeButton = document.getElementById('complete-button');
    if (completeButton && !completedDays.includes(currentDay)) {
      completeButton.style.background = 'linear-gradient(135deg, #90EE90 0%, #98FB98 100%)';
      completeButton.textContent = 'All Done! Click to Continue';
      completeButton.disabled = false;
    }
  }
}

// æ–‡æœ¬è½¬è¯­éŸ³æœ—è¯»åŠŸèƒ½
function playAudio(sentenceId, event) {
  console.log('Playing audio for:', sentenceId);
  
  // è·å–å¥å­æ–‡æœ¬
  const sentences = {
    'its-christmas': "It's Christmas.",
    'i-see-christmas-tree': "I see a Christmas tree.",
    'i-like-christmas': "I like Christmas.",
    'this-is-santa': "This is Santa.",
    'santa-is-happy': "Santa is happy.",
    'i-like-santa': "I like Santa.",
    'i-see-gift': "I see a gift.",
    'santa-has-gifts': "Santa has gifts.",
    'i-like-gifts': "I like gifts.",
    'i-have-gift': "I have a gift.",
    'gift-is-nice': "The gift is nice.",
    'i-am-happy': "I am happy.",
    'merry-christmas': "Merry Christmas!",
    'we-say-merry-christmas': "We say Merry Christmas.",
    'i-like-christmas-final': "I like Christmas."
  };
  
  const text = sentences[sentenceId];
  if (!text) {
    console.log('Unknown sentence ID:', sentenceId);
    return;
  }
  
  try {
    // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆ
    if ('speechSynthesis' in window) {
      // åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
      window.speechSynthesis.cancel();
      
      // åˆ›å»ºè¯­éŸ³åˆæˆå®ä¾‹
      const utterance = new SpeechSynthesisUtterance(text);
      
      // è®¾ç½®è¯­éŸ³å‚æ•° - é€‚åˆå„¿ç«¥å­¦ä¹ 
      utterance.rate = 0.7; // è¾ƒæ…¢çš„è¯­é€Ÿ
      utterance.pitch = 1.1; // ç¨é«˜çš„éŸ³è°ƒï¼Œæ›´æ¸©å’Œ
      utterance.volume = 0.8; // é€‚ä¸­çš„éŸ³é‡
      
      // ä¼˜å…ˆä½¿ç”¨è‹±æ–‡è¯­éŸ³
      const voices = window.speechSynthesis.getVoices();
      const englishVoice = voices.find(voice => 
        voice.lang.startsWith('en') && 
        (voice.name.includes('Child') || voice.name.includes('Female') || voice.name.includes('Google'))
      );
      
      if (englishVoice) {
        utterance.voice = englishVoice;
      }
      
      // æ’­æ”¾å®Œæˆåçš„å›è°ƒ
      utterance.onend = function() {
        console.log('è¯­éŸ³æ’­æ”¾å®Œæˆ');
        // æ ‡è®°è¯¥å¥å­ä¸ºå·²æ’­æ”¾
        playedSentences.add(sentenceId);
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¥å­éƒ½å·²æ’­æ”¾
        checkAllSentencesPlayed();
      };
      
      // å¼€å§‹æ’­æ”¾
      window.speechSynthesis.speak(utterance);
      
    } else {
      // å¦‚æœä¸æ”¯æŒè¯­éŸ³åˆæˆï¼Œä½¿ç”¨ç®€å•çš„æç¤ºéŸ³
      playSimpleBeep();
      // ä»ç„¶æ ‡è®°ä¸ºå·²æ’­æ”¾ï¼ˆé™çº§å¤„ç†ï¼‰
      playedSentences.add(sentenceId);
      setTimeout(() => {
        checkAllSentencesPlayed();
      }, 300);
    }
    
  } catch (error) {
    console.log('è¯­éŸ³æ’­æ”¾å¤±è´¥:', error);
    alert('è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®');
  }
  
  // æŒ‰é’®åŠ¨ç”»åé¦ˆ
  const button = event && event.target ? event.target.closest('.play-button') : null;
  if (button) {
    button.style.transform = 'scale(0.9)';
    setTimeout(() => {
      button.style.transform = '';
    }, 200);
  }
}

// ç®€å•çš„æç¤ºéŸ³ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
function playSimpleBeep() {
  try {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
    gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.3);
  } catch (error) {
    console.log('æç¤ºéŸ³æ’­æ”¾å¤±è´¥:', error);
  }
}

// é¢„åŠ è½½è¯­éŸ³
function preloadVoices() {
  if ('speechSynthesis' in window) {
    // æŸäº›æµè§ˆå™¨éœ€è¦ç­‰å¾…voicesåŠ è½½å®Œæˆ
    window.speechSynthesis.onvoiceschanged = function() {
      console.log('è¯­éŸ³åˆ—è¡¨å·²åŠ è½½');
    };
  }
}

// é¡µé¢åŠ è½½åŠ¨ç”»
 document.addEventListener('DOMContentLoaded', function() {
   // é¢„åŠ è½½è¯­éŸ³
   preloadVoices();
  const cards = document.querySelectorAll('.sentence-card');
  cards.forEach((card, index) => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(30px)';
    
    setTimeout(() => {
      card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, index * 200);
  });
});

// åœ£è¯èŠ‚å­¦ä¹ å†…å®¹æ•°æ®
const christmasContent = {
  1: {
    title: "Christmas Learning - Day 1!",
    description: "",
    sentences: [
      {
        text: "It's Christmas.",
        audio: "its-christmas",
        image: "tree"
      },
      {
        text: "I see a Christmas tree.",
        audio: "i-see-christmas-tree",
        image: "tree-child"
      },
      {
        text: "I like Christmas.",
        audio: "i-like-christmas",
        image: "lights"
      }
    ],
    story: null,
    showStory: false
  },
  2: {
    title: "Christmas Learning - Day 2!",
    description: "",
    sentences: [
      {
        text: "This is Santa.",
        audio: "this-is-santa",
        image: "santa"
      },
      {
        text: "Santa is happy.",
        audio: "santa-is-happy",
        image: "santa-happy"
      },
      {
        text: "I like Santa.",
        audio: "i-like-santa",
        image: "santa-child"
      }
    ],
    story: [
      { text: "It's Christmas.", image: "tree" },
      { text: "I see a Christmas tree.", image: "tree-child" },
      { text: "This is Santa.", image: "santa" },
      { text: "Santa is happy.", image: "santa-happy" }
    ],
    showStory: true
  },
  3: {
    title: "Christmas Learning - Day 3!",
    description: "",
    sentences: [
      {
        text: "I see a gift.",
        audio: "i-see-gift",
        image: "gift"
      },
      {
        text: "Santa has gifts.",
        audio: "santa-has-gifts",
        image: "santa-gifts"
      },
      {
        text: "I like gifts.",
        audio: "i-like-gifts",
        image: "gifts"
      }
    ],
    story: [
      { text: "It's Christmas.", image: "tree" },
      { text: "I see a Christmas tree.", image: "tree-child" },
      { text: "This is Santa.", image: "santa" },
      { text: "Santa is happy.", image: "santa-happy" },
      { text: "Santa has gifts.", image: "santa-gifts" },
      { text: "I see a gift.", image: "gift" }
    ],
    showStory: true
  },
  4: {
    title: "Christmas Learning - Day 4!",
    description: "",
    sentences: [
      {
        text: "I have a gift.",
        audio: "i-have-gift",
        image: "child-gift"
      },
      {
        text: "The gift is nice.",
        audio: "gift-is-nice",
        image: "nice-gift"
      },
      {
        text: "I am happy.",
        audio: "i-am-happy",
        image: "happy-child"
      }
    ],
    story: [
      { text: "It's Christmas.", image: "tree" },
      { text: "I see a Christmas tree.", image: "tree-child" },
      { text: "This is Santa.", image: "santa" },
      { text: "Santa has gifts.", image: "santa-gifts" },
      { text: "I have a gift.", image: "child-gift" },
      { text: "The gift is nice.", image: "nice-gift" },
      { text: "I am happy.", image: "happy-child" }
    ],
    showStory: true
  },
  5: {
    title: "Christmas Learning - Day 5!",
    description: "",
    sentences: [
      {
        text: "Merry Christmas!",
        audio: "merry-christmas",
        image: "merry-christmas"
      },
      {
        text: "We say \"Merry Christmas\".",
        audio: "we-say-merry-christmas",
        image: "say-merry"
      },
      {
        text: "I like Christmas.",
        audio: "i-like-christmas-final",
        image: "final-christmas"
      }
    ],
    story: [
      { text: "It's Christmas.", image: "tree" },
      { text: "I see a Christmas tree.", image: "tree-child" },
      { text: "This is Santa.", image: "santa" },
      { text: "Santa has gifts.", image: "santa-gifts" },
      { text: "I have a gift.", image: "child-gift" },
      { text: "I am happy.", image: "happy-child" },
      { text: "Merry Christmas!", image: "merry-christmas" }
    ],
    showStory: true
  },
  6: {
    title: "Christmas Learning - Day 6!",
    description: "",
    sentences: [],
    story: [
      { text: "It's Christmas.", image: "tree" },
      { text: "I see a Christmas tree.", image: "tree-child" },
      { text: "This is Santa.", image: "santa" },
      { text: "Santa is happy.", image: "santa-happy" },
      { text: "Santa has gifts.", image: "santa-gifts" },
      { text: "I have a gift.", image: "child-gift" },
      { text: "The gift is nice.", image: "nice-gift" },
      { text: "I am happy.", image: "happy-child" },
      { text: "Merry Christmas!", image: "merry-christmas" }
    ],
    showStory: true,
    isReviewDay: true
  }
};

let currentDay = 1;
let completedDays = JSON.parse(localStorage.getItem('christmasCompletedDays') || '[]');

// åˆå§‹åŒ–é¡µé¢
function initializePage() {
  loadDay(currentDay);
  updateProgress();
  updateNavigationButtons();
}

// åŠ è½½ç‰¹å®šå¤©æ•°çš„å†…å®¹
function loadDay(day) {
  const content = christmasContent[day];
  
  // æ›´æ–°æ ‡é¢˜
  document.getElementById('day-title').textContent = content.title;
  
  // æ›´æ–°æè¿°
  document.getElementById('day-description').innerHTML = content.description;
  
  // æ›´æ–°å¥å­å†…å®¹
  const sentencesContainer = document.getElementById('learning-sentences');
  sentencesContainer.innerHTML = '';
  
  if (content.isReviewDay) {
    // ç¬¬å…­å¤©åªæ˜¾ç¤ºæ•…äº‹å¤ä¹ 
    sentencesContainer.style.display = 'none';
  } else {
    sentencesContainer.style.display = 'flex';
    content.sentences.forEach((sentence, index) => {
      const sentenceCard = createSentenceCard(sentence, index);
      sentencesContainer.appendChild(sentenceCard);
    });
  }
  
  // Update Story Section - Only show Play Button, hide content
  const storySection = document.getElementById('story-section');
  const storyContentEl = document.getElementById('story-content');
  
  // Always clear and hide the content div to remove whitespace
  storyContentEl.innerHTML = '';
  storyContentEl.style.display = 'none';
  
  // Show the section for all days to allow playing "Story Time" (all sentences so far)
  storySection.style.display = 'block';
  
  // é‡æ–°è§¦å‘åŠ¨ç”»
  setTimeout(() => {
    const cards = document.querySelectorAll('.sentence-card');
    cards.forEach((card, i) => {
      card.style.opacity = '0';
      card.style.transform = 'translateY(10px)';
      
      setTimeout(() => {
        card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, i * 120);
    });
  }, 100);
}

// åˆ›å»ºå¥å­å¡ç‰‡
function createSentenceCard(sentence, index) {
  const card = document.createElement('div');
  card.className = 'sentence-card';
  
  // æ ¹æ®å›¾ç‰‡ç±»å‹ç”Ÿæˆä¸åŒçš„SVGæ’å›¾
  let svgContent = getSVGImage(sentence.image, sentence.text);
  
  card.innerHTML = `
    <div class="sentence-image">
      ${svgContent}
    </div>
    <div class="sentence-text">${sentence.text}</div>
    <button class="play-button" onclick="playAudio('${sentence.audio}', event)">
      <svg viewBox="0 0 24 24" class="play-icon">
        <polygon points="5,3 19,12 5,21" fill="currentColor"/>
      </svg>
    </button>
  `;
  return card;
}

// æ ¹æ®å›¾ç‰‡ç±»å‹ç”ŸæˆSVGæ’å›¾
function getSVGImage(imageType, text) {
  const baseStyle = 'style="background: linear-gradient(135deg, #FFF8F0 0%, #FFE4B5 100%);"';
  
  switch(imageType) {
    case 'tree':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- åœ£è¯æ ‘ -->
        <polygon points="100,30 80,60 90,60 70,90 110,90 90,60 100,60" fill="#228B22"/>
        <polygon points="100,50 85,75 95,75 75,100 115,100 95,75 105,75" fill="#32CD32"/>
        <polygon points="100,70 90,90 100,90 80,115 120,115 100,90 110,90" fill="#228B22"/>
        <rect x="95" y="115" width="10" height="15" fill="#8B4513"/>
        <circle cx="85" cy="40" r="3" fill="#FFD700"/>
        <circle cx="105" cy="45" r="2" fill="#FF69B4"/>
        <circle cx="95" cy="55" r="2" fill="#FF0000"/>
        <circle cx="110" cy="65" r="3" fill="#FFD700"/>
        <circle cx="90" cy="80" r="2" fill="#FF69B4"/>
        <circle cx="105" cy="85" r="2" fill="#FF0000"/>
      </svg>`;
      
    case 'tree-child':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å­©å­çœ‹åœ£è¯æ ‘ -->
        <circle cx="60" cy="80" r="25" fill="#FFB6C1"/>
        <circle cx="55" cy="75" r="2" fill="#000"/>
        <circle cx="65" cy="75" r="2" fill="#000"/>
        <path d="M60,85 Q55,90 60,92 Q65,90 60,85" fill="#FF69B4"/>
        <rect x="50" y="95" width="20" height="25" fill="#87CEEB" rx="5"/>
        
        <polygon points="140,40 130,60 135,60 125,80 145,80 135,60 140,60" fill="#228B22"/>
        <polygon points="140,60 132,75 137,75 127,90 147,90 137,75 142,75" fill="#32CD32"/>
        <rect x="137" y="90" width="6" height="8" fill="#8B4513"/>
        <circle cx="135" cy="50" r="2" fill="#FFD700"/>
        <circle cx="143" cy="55" r="1" fill="#FF69B4"/>
      </svg>`;
      
    case 'lights':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <path d="M20,30 Q50,20 80,30 Q110,20 140,30 Q170,20 180,30" stroke="#FFD700" stroke-width="3" fill="none"/>
        <circle cx="30" cy="28" r="4" fill="#FF0000"/>
        <circle cx="60" cy="23" r="4" fill="#00FF00"/>
        <circle cx="90" cy="28" r="4" fill="#0000FF"/>
        <circle cx="120" cy="23" r="4" fill="#FF69B4"/>
        <circle cx="150" cy="28" r="4" fill="#FFD700"/>
        <circle cx="170" cy="28" r="4" fill="#FF0000"/>
        
        <path d="M30,60 Q60,50 90,60 Q120,50 150,60 Q170,50 180,60" stroke="#FFD700" stroke-width="3" fill="none"/>
        <circle cx="40" cy="58" r="4" fill="#00FF00"/>
        <circle cx="70" cy="53" r="4" fill="#FF69B4"/>
        <circle cx="100" cy="58" r="4" fill="#FF0000"/>
        <circle cx="130" cy="53" r="4" fill="#0000FF"/>
        <circle cx="160" cy="58" r="4" fill="#FFD700"/>
      </svg>`;
      
    case 'santa':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- ç”ŸåŠ¨åœ£è¯è€äºº -->
        <path d="M100 10 C70 10 70 40 100 40 C130 40 130 10 100 10 Z" fill="#D32F2F"/>
        <ellipse cx="100" cy="10" rx="12" ry="8" fill="#FFFFFF"/>
        <circle cx="100" cy="60" r="28" fill="#FDBCB4"/>
        <ellipse cx="88" cy="54" rx="4" ry="6" fill="#FFFFFF"/>
        <ellipse cx="112" cy="54" rx="4" ry="6" fill="#FFFFFF"/>
        <circle cx="88" cy="54" r="2.5" fill="#000"/>
        <circle cx="112" cy="54" r="2.5" fill="#000"/>
        <circle cx="75" cy="65" r="6" fill="#F48FB1" opacity=".6"/>
        <circle cx="125" cy="65" r="6" fill="#F48FB1" opacity=".6"/>
        <circle cx="100" cy="65" r="4" fill="#E57373"/>
        <path d="M85 75 Q100 85 115 75" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M70 78 Q85 88 100 82 M100 82 Q115 88 130 78" fill="#FFFFFF" stroke="#E0E0E0" stroke-width="1.5"/>
        <rect x="80" y="88" width="40" height="45" rx="8" fill="#D32F2F"/>
        <rect x="80" y="108" width="40" height="8" fill="#1A1A1A"/>
        <rect x="97" y="104" width="6" height="16" rx="3" fill="#B8860B"/>
        <rect x="65" y="95" width="15" height="30" rx="7" fill="#D32F2F"/>
        <rect x="120" y="95" width="15" height="30" rx="7" fill="#D32F2F"/>
        <circle cx="72" cy="128" r="8" fill="#FFFFFF"/>
        <circle cx="128" cy="128" r="8" fill="#FFFFFF"/>
        <path d="M85 145 Q85 155 95 155 Q105 155 115 145 Z" fill="#4E342E"/>
      </svg>`;
      
    case 'santa-happy':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- è¶…å¼€å¿ƒåœ£è¯è€äºº -->
        <path d="M100 8 C68 8 68 42 100 42 C132 42 132 8 100 8 Z" fill="#C62828"/>
        <ellipse cx="100" cy="8" rx="14" ry="9" fill="#FFFFFF"/>
        <circle cx="100" cy="62" r="30" fill="#FFCCBC"/>
        <path d="M82 50 Q88 44 94 50" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M106 50 Q112 44 118 50" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <circle cx="75" cy="66" r="7" fill="#F48FB1" opacity=".7"/>
        <circle cx="125" cy="66" r="7" fill="#F48FB1" opacity=".7"/>
        <circle cx="100" cy="68" r="4" fill="#E57373"/>
        <path d="M80 78 Q100 92 120 78" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M65 80 Q85 95 100 85 M100 85 Q115 95 135 80" fill="#FFFFFF" stroke="#E0E0E0" stroke-width="2"/>
        <rect x="75" y="92" width="50" height="48" rx="10" fill="#C62828"/>
        <rect x="75" y="116" width="50" height="10" fill="#1A1A1A"/>
        <rect x="97" y="112" width="6" height="18" rx="3" fill="#B8860B"/>
        <rect x="58" y="100" width="18" height="32" rx="9" fill="#C62828"/>
        <rect x="124" y="100" width="18" height="32" rx="9" fill="#C62828"/>
        <circle cx="67" cy="138" r="9" fill="#FFFFFF"/>
        <circle cx="133" cy="138" r="9" fill="#FFFFFF"/>
        <path d="M80 150 Q80 162 92 162 Q108 162 120 150 Z" fill="#3E2723"/>
      </svg>`;
      
    case 'santa-child':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- æ¸©é¦¨äº’åŠ¨ï¼šå­©å­ä¸åœ£è¯è€äºº -->
        <!-- å­©å­ -->
        <circle cx="60" cy="80" r="22" fill="#FFCCBC"/>
        <!-- å­©å­çš„ç¬‘çœ¼ -->
        <path d="M48 72 Q54 66 60 72" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M62 72 Q68 66 74 72" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <!-- é¼»å­ -->
        <circle cx="60" cy="80" r="3" fill="#E57373"/>
        <!-- å¤§ç¬‘ -->
        <path d="M48 90 Q60 98 72 90" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <!-- è¡£æœ -->
        <rect x="45" y="95" width="30" height="28" rx="6" fill="#81D4FA"/>
        <!-- æ‰‹ -->
        <circle cx="40" cy="105" r="7" fill="#FFCCBC"/>
        <circle cx="80" cy="105" r="7" fill="#FFCCBC"/>
        
        <!-- åœ£è¯è€äºº -->
        <!-- å¸½å­ -->
        <path d="M130 48 C105 48 105 78 130 78 C155 78 155 48 130 48 Z" fill="#C62828"/>
        <ellipse cx="130" cy="48" rx="10" ry="6" fill="#FFFFFF"/>
        <!-- è„¸ -->
        <circle cx="130" cy="85" r="24" fill="#FDBCB4"/>
        <!-- ç¬‘çœ¼ -->
        <path d="M118 77 Q124 71 130 77" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M130 77 Q136 71 142 77" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <!-- é¼»å­ -->
        <circle cx="130" cy="87" r="3" fill="#E57373"/>
        <!-- å¾®ç¬‘ -->
        <path d="M115 95 Q130 105 145 95" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <!-- èƒ¡å­ -->
        <path d="M100 90 Q120 105 130 98 M130 98 Q140 105 160 90" fill="#FFFFFF" stroke="#E0E0E0" stroke-width="1.5"/>
        <!-- èº«ä½“ -->
        <rect x="110" y="98" width="40" height="38" rx="8" fill="#C62828"/>
        <!-- è…°å¸¦ -->
        <rect x="110" y="125" width="40" height="6" fill="#1A1A1A"/>
        <rect cx="130" cy="122" r="4" fill="#B8860B"/>
        <!-- æ‰‹ -->
        <circle cx="95" cy="115" r="8" fill="#FFFFFF"/>
        <circle cx="165" cy="115" r="8" fill="#FFFFFF"/>
        <!-- é´å­ -->
        <path d="M115 145 Q115 155 125 155 Q135 155 145 145 Z" fill="#3E2723"/>
      </svg>`;
      
    case 'gift':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- ç¤¼ç‰©ç›’ -->
        <rect x="60" y="60" width="80" height="60" fill="#FF0000" rx="5"/>
        <rect x="95" y="60" width="10" height="60" fill="#FFD700"/>
        <rect x="60" y="85" width="80" height="10" fill="#FFD700"/>
        <polygon points="100,50 95,60 105,60" fill="#FFD700"/>
        <circle cx="95" cy="55" r="5" fill="#FFD700"/>
        <circle cx="105" cy="55" r="5" fill="#FFD700"/>
        <rect x="92" y="52" width="16" height="6" fill="#FFD700" rx="3"/>
      </svg>`;

    case 'gifts':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å¤šä¸ªç¤¼ç‰© -->
        <rect x="35" y="85" width="45" height="35" fill="#FF5252" rx="4"/>
        <rect x="55" y="85" width="5" height="35" fill="#FFD700"/>
        <rect x="35" y="95" width="45" height="5" fill="#FFD700"/>
        
        <rect x="115" y="75" width="55" height="45" fill="#448AFF" rx="4"/>
        <rect x="140" y="75" width="8" height="45" fill="#FFFFFF"/>
        <rect x="115" y="95" width="55" height="8" fill="#FFFFFF"/>
        
        <rect x="70" y="50" width="60" height="50" fill="#69F0AE" rx="4"/>
        <rect x="95" y="50" width="10" height="50" fill="#FF4081"/>
        <rect x="70" y="70" width="60" height="10" fill="#FF4081"/>
        
        <!-- è´è¶ç»“ -->
        <circle cx="58" cy="85" r="3" fill="#FFD700"/>
        <circle cx="144" cy="75" r="3" fill="#FFFFFF"/>
        <circle cx="100" cy="50" r="4" fill="#FF4081"/>
        
        <circle cx="40" cy="40" r="3" fill="#FFD700" opacity="0.5"/>
        <circle cx="160" cy="30" r="4" fill="#FFD700" opacity="0.4"/>
      </svg>`;
      
    case 'santa-gifts':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å¼€å¿ƒé€ç¤¼ï¼šåœ£è¯è€äººä¸ç¤¼ç‰©å±± -->
        <!-- åœ£è¯è€äºº -->
        <path d="M100 12 C72 12 72 44 100 44 C128 44 128 12 100 12 Z" fill="#C62828"/>
        <ellipse cx="100" cy="12" rx="11" ry="7" fill="#FFFFFF"/>
        <circle cx="100" cy="66" r="26" fill="#FDBCB4"/>
        <path d="M84 56 Q90 50 96 56" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M104 56 Q110 50 116 56" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <circle cx="79" cy="70" r="6" fill="#F48FB1" opacity=".6"/>
        <circle cx="121" cy="70" r="6" fill="#F48FB1" opacity=".6"/>
        <circle cx="100" cy="70" r="4" fill="#E57373"/>
        <path d="M82 78 Q100 88 118 78" stroke="#000" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M70 80 Q90 95 100 87 M100 87 Q110 95 130 80" fill="#FFFFFF" stroke="#E0E0E0" stroke-width="1.5"/>
        <rect x="78" y="88" width="44" height="40" rx="8" fill="#C62828"/>
        <rect x="78" y="118" width="44" height="6" fill="#1A1A1A"/>
        <rect x="97" y="115" width="6" height="12" rx="3" fill="#B8860B"/>
        <!-- ç¤¼ç‰©å±± -->
        <rect x="40" y="125" width="25" height="15" fill="#FF1744" rx="3"/>
        <rect x="52" y="115" width="20" height="15" fill="#00E676" rx="3"/>
        <rect x="65" y="105" width="22" height="15" fill="#2196F3" rx="3"/>
        <rect x="110" y="120" width="28" height="20" fill="#FF9800" rx="3"/>
        <rect x="125" y="110" width="24" height="18" fill="#9C27B0" rx="3"/>
        <!-- è´è¶ç»“ -->
        <path d="M52,125 Q50,120 55,122 Q60,120 58,125 Q60,130 55,128 Q50,130 52,125 Z" fill="#FFD700"/>
        <path d="M127,120 Q125,115 130,117 Q135,115 133,120 Q135,125 130,123 Q125,125 127,120 Z" fill="#FFD700"/>
      </svg>`;
      
    case 'tree-with-lights':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å¸¦å½©ç¯çš„åœ£è¯æ ‘ -->
        <polygon points="100,30 80,60 90,60 70,90 110,90 90,60 100,60" fill="#228B22"/>
        <polygon points="100,50 85,75 95,75 75,100 115,100 95,75 105,75" fill="#32CD32"/>
        <polygon points="100,70 90,90 100,90 80,115 120,115 100,90 110,90" fill="#228B22"/>
        <rect x="95" y="115" width="10" height="15" fill="#8B4513"/>
        <circle cx="85" cy="40" r="3" fill="#FF0000"/>
        <circle cx="105" cy="45" r="2" fill="#00FF00"/>
        <circle cx="95" cy="55" r="2" fill="#0000FF"/>
        <circle cx="110" cy="65" r="3" fill="#FFD700"/>
        <circle cx="90" cy="80" r="2" fill="#FF69B4"/>
        <circle cx="105" cy="85" r="2" fill="#FF0000"/>
        <path d="M75,35 Q90,30 105,35" stroke="#FFD700" stroke-width="2" fill="none"/>
        <path d="M80,55 Q95,50 110,55" stroke="#FFD700" stroke-width="2" fill="none"/>
        <path d="M85,75 Q100,70 115,75" stroke="#FFD700" stroke-width="2" fill="none"/>
      </svg>`;
      
    case 'gift-under-tree':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- åœ£è¯æ ‘ä¸‹çš„ç¤¼ç‰© -->
        <polygon points="100,25 85,50 92,50 75,80 125,80 108,50 115,50" fill="#228B22"/>
        <rect x="95" y="80" width="10" height="12" fill="#8B4513"/>
        <rect x="70" y="85" width="25" height="20" fill="#FF1744" rx="3"/>
        <rect x="80" y="85" width="5" height="20" fill="#FFD700"/>
        <rect x="70" y="92" width="25" height="6" fill="#FFD700"/>
        <rect x="105" y="90" width="20" height="15" fill="#00E676" rx="3"/>
        <rect x="114" y="90" width="2" height="15" fill="#FFD700"/>
        <rect x="105" y="97" width="20" height="2" fill="#FFD700"/>
        <path d="M82,85 Q80,80 85,82 Q90,80 88,85 Q90,90 85,88 Q80,90 82,85 Z" fill="#FFD700"/>
        <path d="M113,90 Q111,85 116,87 Q121,85 119,90 Q121,95 116,93 Q111,95 113,90 Z" fill="#FFD700"/>
      </svg>`;

    case 'child-gift':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å­©å­æ‹¿ç€ç¤¼ç‰© -->
        <circle cx="100" cy="60" r="25" fill="#FFB6C1"/>
        <circle cx="92" cy="55" r="2.5" fill="#000"/>
        <circle cx="108" cy="55" r="2.5" fill="#000"/>
        <path d="M92,65 Q100,72 108,65" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"/>
        <rect x="80" y="85" width="40" height="35" fill="#87CEEB" rx="8"/>
        <rect x="85" y="90" width="30" height="25" fill="#FF4081" rx="4"/>
        <rect x="98" y="90" width="4" height="25" fill="#FFD700"/>
        <rect x="85" y="100" width="30" height="4" fill="#FFD700"/>
        <path d="M90,90 Q90,82 100,82 Q110,82 110,90" fill="none" stroke="#FFD700" stroke-width="3"/>
      </svg>`;

    case 'nice-gift':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- ç²¾ç¾çš„ç¤¼ç‰©ç‰¹å†™ -->
        <rect x="60" y="50" width="80" height="70" fill="#9C27B0" rx="6"/>
        <rect x="95" y="50" width="10" height="70" fill="#E1BEE7"/>
        <rect x="60" y="80" width="80" height="10" fill="#E1BEE7"/>
        <path d="M60,50 L100,20 L140,50" fill="#7B1FA2" opacity="0.3"/>
        <circle cx="100" cy="50" r="12" fill="#E1BEE7"/>
        <circle cx="90" cy="40" r="10" fill="#BA68C8"/>
        <circle cx="110" cy="40" r="10" fill="#BA68C8"/>
        <path d="M80,30 Q90,10 100,30 Q110,10 120,30" stroke="#E1BEE7" stroke-width="3" fill="none"/>
        <circle cx="50" cy="100" r="5" fill="#FFD700" opacity="0.6"/>
        <circle cx="160" cy="40" r="5" fill="#FFD700" opacity="0.6"/>
      </svg>`;

    case 'happy-child':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å¼€å¿ƒçš„å­©å­ -->
        <circle cx="100" cy="70" r="35" fill="#FFCCBC"/>
        <path d="M85,60 Q92,55 100,60" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M100,60 Q108,55 115,60" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <circle cx="100" cy="70" r="4" fill="#E57373"/>
        <path d="M85,85 Q100,100 115,85" stroke="#000" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M75,85 Q80,95 85,90" stroke="#FF8A80" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M125,85 Q120,95 115,90" stroke="#FF8A80" stroke-width="2" fill="none" opacity="0.6"/>
        <rect x="70" y="105" width="60" height="40" rx="15" fill="#FFEB3B"/>
        <path d="M60,100 L50,80" stroke="#FFCCBC" stroke-width="8" stroke-linecap="round"/>
        <path d="M140,100 L150,80" stroke="#FFCCBC" stroke-width="8" stroke-linecap="round"/>
        <circle cx="50" cy="75" r="6" fill="#FFCCBC"/>
        <circle cx="150" cy="75" r="6" fill="#FFCCBC"/>
      </svg>`;

    case 'merry-christmas':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- Merry Christmas æ–‡å­— -->
        <defs>
          <linearGradient id="textGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#D32F2F;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#2E7D32;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#D32F2F;stop-opacity:1" />
          </linearGradient>
        </defs>
        <text x="100" y="60" text-anchor="middle" font-family="Comic Sans MS, cursive" font-size="28" font-weight="bold" fill="url(#textGrad)">Merry</text>
        <text x="100" y="95" text-anchor="middle" font-family="Comic Sans MS, cursive" font-size="28" font-weight="bold" fill="url(#textGrad)">Christmas!</text>
        <path d="M40,75 Q100,130 160,75" stroke="#FFD700" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
        <circle cx="30" cy="40" r="5" fill="#FF0000"/>
        <circle cx="170" cy="110" r="5" fill="#008000"/>
        <polygon points="100,20 105,35 120,35 110,45 115,60 100,50 85,60 90,45 80,35 95,35" fill="#FFD700"/>
      </svg>`;

    case 'say-merry':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- å¤§å®¶ä¸€èµ·è¯´ -->
        <circle cx="70" cy="80" r="20" fill="#FFCCBC"/>
        <circle cx="130" cy="80" r="20" fill="#D7CCC8"/>
        <rect x="50" y="100" width="40" height="30" fill="#FF9800" rx="5"/>
        <rect x="110" y="100" width="40" height="30" fill="#4CAF50" rx="5"/>
        <path d="M70,90 Q70,95 75,90" stroke="#000" stroke-width="2" fill="none"/>
        <path d="M130,90 Q130,95 135,90" stroke="#000" stroke-width="2" fill="none"/>
        <path d="M60,40 Q90,20 100,40 L90,50" stroke="#333" stroke-width="1" fill="white"/>
        <path d="M140,40 Q110,20 100,40 L110,50" stroke="#333" stroke-width="1" fill="white"/>
        <ellipse cx="80" cy="35" rx="25" ry="15" fill="#FFF" stroke="#333" stroke-width="1"/>
        <text x="80" y="38" text-anchor="middle" font-size="8">Merry!</text>
        <ellipse cx="120" cy="35" rx="25" ry="15" fill="#FFF" stroke="#333" stroke-width="1"/>
        <text x="120" y="38" text-anchor="middle" font-size="8">Christmas!</text>
      </svg>`;

    case 'final-christmas':
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <!-- æœ€ç»ˆå¤§åˆå½±æ„Ÿè§‰ -->
        <polygon points="50,40 35,70 45,70 30,100 70,100 55,70 65,70" fill="#228B22"/>
        <rect x="45" y="100" width="10" height="10" fill="#8B4513"/>
        <circle cx="150" cy="60" r="25" fill="#FDBCB4"/> <!-- Santa -->
        <rect x="130" y="85" width="40" height="35" fill="#D32F2F" rx="5"/>
        <circle cx="100" cy="80" r="20" fill="#FFCCBC"/> <!-- Child -->
        <rect x="85" y="100" width="30" height="30" fill="#2196F3" rx="5"/>
        <circle cx="50" cy="30" r="5" fill="#FFD700"/>
        <circle cx="30" cy="20" r="2" fill="#FFF" opacity="0.8"/>
        <circle cx="180" cy="30" r="2" fill="#FFF" opacity="0.8"/>
        <circle cx="100" cy="20" r="2" fill="#FFF" opacity="0.8"/>
      </svg>`;

    default:
      return `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" ${baseStyle}>
        <rect width="200" height="150" fill="#FFF8F0"/>
        <text x="100" y="75" text-anchor="middle" fill="#999" font-size="14">Image: ${imageType}</text>
      </svg>`;
  }
}

// å®Œæˆå½“å¤©å­¦ä¹ 
function completeDay() {
  if (!completedDays.includes(currentDay)) {
    completedDays.push(currentDay);
    localStorage.setItem('christmasCompletedDays', JSON.stringify(completedDays));
  }
  
  updateProgress();
  updateNavigationButtons();
  
  // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
  const button = document.getElementById('complete-button');
  button.textContent = 'âœ“ Completed!';
  button.style.background = 'linear-gradient(135deg, #90EE90 0%, #98FB98 100%)';
  
  setTimeout(() => {
    if (currentDay < 6) {
      nextDay();
    }
  }, 1500);
}

// ä¸‹ä¸€å¤©
function nextDay() {
  if (currentDay < 6) {
    currentDay++;
    playedSentences.clear(); // é‡ç½®å·²æœ—è¯»çš„å¥å­è·Ÿè¸ª
    loadDay(currentDay);
    updateNavigationButtons();
  }
}

// å‰ä¸€å¤©
function previousDay() {
  if (currentDay > 1) {
    currentDay--;
    playedSentences.clear(); // é‡ç½®å·²æœ—è¯»çš„å¥å­è·Ÿè¸ª
    loadDay(currentDay);
    updateNavigationButtons();
  }
}

// æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
function updateNavigationButtons() {
  const prevButton = document.getElementById('prev-button');
  const nextButton = document.getElementById('next-button');
  const completeButton = document.getElementById('complete-button');

  // å‰ä¸€å¤©æŒ‰é’®
  if (currentDay > 1) {
    prevButton.style.display = 'inline-block';
  } else {
    prevButton.style.display = 'none';
  }

  // åä¸€å¤©æŒ‰é’®ï¼ˆåªè¦æœªåˆ°ç¬¬ 6 å¤©å°±æ˜¾ç¤ºï¼Œæ— éœ€å…ˆå®Œæˆï¼‰
  if (currentDay < 6) {
    nextButton.style.display = 'inline-block';
  } else {
    nextButton.style.display = 'none';
  }

  // å®ŒæˆæŒ‰é’®
  if (completedDays.includes(currentDay)) {
    completeButton.textContent = 'âœ“ å·²å®Œæˆï¼';
    completeButton.style.background = 'linear-gradient(135deg, #90EE90 0%, #98FB98 100%)';
  } else {
    const currentSentenceIds = getCurrentDaySentenceIds();
    const allPlayed = currentSentenceIds.every(id => playedSentences.has(id));

    if (allPlayed && currentSentenceIds.length > 0) {
      completeButton.textContent = 'All Done! Click to Continue';
      completeButton.style.background = 'linear-gradient(135deg, #90EE90 0%, #98FB98 100%)';
      completeButton.disabled = false;
    } else {
      completeButton.textContent = 'Listen to All Sentences First';
      completeButton.style.background = 'linear-gradient(135deg, #CCCCCC 0%, #DDDDDD 100%)';
      completeButton.disabled = true;
    }
  }
}

// æ›´æ–°è¿›åº¦æ¡
function updateProgress() {
  // è¿›åº¦æ¡å·²ç§»é™¤ï¼Œé¿å…JSé”™è¯¯ï¼Œç›´æ¥å®‰å…¨è¿”å›
  return;
}

// æ’­æ”¾å®Œæ•´æ•…äº‹ï¼ˆä½¿ç”¨è¯­éŸ³åˆæˆé€å¥æ’­æ”¾ï¼‰
let storySpeaking = false;
function playStory(event) {
  let sentences = [];
  
  // ä»Day 1å¼€å§‹åˆ°å½“å‰é¡µé¢çš„æ‰€æœ‰å¥å­
  for (let i = 1; i <= currentDay; i++) {
    const dayContent = christmasContent[i];
    if (dayContent && dayContent.sentences) {
      dayContent.sentences.forEach(s => {
        sentences.push(s.text);
      });
    }
  }
  
  if (sentences.length === 0) return;
  
  // é˜²æ­¢é‡å¤è§¦å‘
  if (storySpeaking) {
    if ('speechSynthesis' in window) {
      window.speechSynthesis.cancel();
    }
    storySpeaking = false;
  }
  
  speakSentencesSequentially(sentences);
}

function speakSentencesSequentially(sentences) {
  if (!('speechSynthesis' in window)) {
    console.log('SpeechSynthesis not supported');
    return;
  }
  
  let index = 0;
  storySpeaking = true;
  
  let voices = window.speechSynthesis.getVoices();
  let preferredVoice = voices.find(v => /en-US/i.test(v.lang) && /female|Google US English/i.test(v.name)) || voices.find(v => /en/i.test(v.lang)) || null;
  
  function speakNext() {
    if (!storySpeaking) return;
    if (index >= sentences.length) {
      storySpeaking = false;
      return;
    }
    const u = new SpeechSynthesisUtterance(sentences[index]);
    u.lang = 'en-US';
    u.rate = 0.8;
    u.pitch = 1.1;
    u.volume = 0.9;
    if (preferredVoice) u.voice = preferredVoice;
    
    u.onend = () => {
      index++;
      setTimeout(speakNext, 300);
    };
    
    u.onerror = () => {
      index++;
      setTimeout(speakNext, 0);
    };
    
    window.speechSynthesis.speak(u);
  }
  
  // å§‹ç»ˆç«‹å³å¼€æ’­ï¼›å½“voiceså¼‚æ­¥åŠ è½½å®Œæˆæ—¶ï¼Œä»…æ›´æ–°preferredVoiceä¾›åç»­å¥å­ä½¿ç”¨
  speakNext();
  window.speechSynthesis.onvoiceschanged = () => {
    voices = window.speechSynthesis.getVoices();
    preferredVoice = voices.find(v => /en-US/i.test(v.lang) && /female|Google US English/i.test(v.name)) || voices.find(v => /en/i.test(v.lang)) || null;
  };
}

function visualHighlightOnly(sentences) {
  const storyContent = document.getElementById('story-content');
  // å…¼å®¹ä¸¤ç§æ¸²æŸ“æ¨¡å¼
  let lines = storyContent.getElementsByClassName('story-card');
  if (lines.length === 0) {
    lines = storyContent.getElementsByClassName('story-line');
  }
  
  let index = 0;
  function next() {
    if (index < sentences.length) {
      if (lines[index]) {
        lines[index].style.background = 'rgba(255, 228, 181, 0.8)';
        setTimeout(() => { lines[index].style.background = ''; }, 800);
      }
      index++;
      setTimeout(next, 1000);
    }
  }
  next();
}

// é¡µé¢åˆå§‹åŒ–
initializePage();
</script>
<style>
/* è¿ç¯ç”»å¡ç‰‡ */
.story-card {
  background: #FFF8F0;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
  margin: 1rem 0;
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  opacity: 0;
  animation: fadeIn 0.5s ease forwards;
}
.story-card:nth-child(2n){ animation-delay: .1s; }
.story-card:nth-child(3n){ animation-delay: .2s; }
.story-image {
  flex: 0 0 120px;
  height: 90px;
}
.story-image svg {
  width: 100%;
  height: 100%;
  border-radius: 8px;
}
.story-text {
  flex: 1;
  font-size: 1.5rem;
  color: #2D3748;
  font-weight: 500;
}
</style>
{{ end }}