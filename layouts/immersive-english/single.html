{{ define "main" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }}</title>
    <style>
        /* é¡µé¢æ•´ä½“é£æ ¼ï¼šæ¸©æš–ã€å®‰é™ã€æ²¡æœ‰å­¦ä¹ æ„Ÿ */
        body {
            margin: 0;
            padding: 0;
            background-color: #FFF8F0; /* æš–ç™½è‰²èƒŒæ™¯ */
            font-family: 'Rounded Mplus 1c', 'Comic Sans MS', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            color: #5D4037;
            opacity: 0; /* åˆå§‹é€æ˜ï¼Œç”¨äºæ·¡å…¥ */
            transition: opacity 2s ease-in-out; /* æ·¡å…¥æ·¡å‡ºåŠ¨ç”» */
        }
        
        body.loaded {
            opacity: 1;
        }

        body.fading-out {
            opacity: 0;
        }

        /* éšè—åŸæœ‰çš„ header/footer å¦‚æœæœ‰çš„è¯ */
        header, footer, nav {
            display: none !important;
        }

        /* 1ï¸âƒ£ ä¸»è§†è§‰åŒºï¼ˆå å±å¹•çº¦ 70%ï¼‰ */
        .visual-container {
            width: 100%;
            height: 70vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .illustration {
            width: 90%;
            max-width: 600px;
            height: auto;
            /* è½»å¾®çš„åŠ¨æ€æ•ˆæœï¼šæ…¢æ…¢å‘¼å¸ */
            animation: breathe 6s ease-in-out infinite;
            transform-origin: center bottom;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        /* æ’­æ”¾æ—¶çš„åŠ¨æ€å˜åŒ– */
        .illustration.playing {
            animation: gentle-shake 2s ease-in-out infinite;
        }

        @keyframes gentle-shake {
            0%, 100% { transform: rotate(0deg) scale(1.03); }
            25% { transform: rotate(1deg) scale(1.03); }
            75% { transform: rotate(-1deg) scale(1.03); }
        }

        /* 4ï¸âƒ£ äº’åŠ¨æŒ‰é’®ï¼ˆä»…ä¸€ä¸ªä¸»è¦æŒ‰é’®ï¼‰ */
        .interaction-area {
            /* ç¨å¾®å¢åŠ é«˜åº¦ä»¥å®¹çº³å‚ç›´æ’åˆ— */
            min-height: 20vh;
            display: flex;
            /* å¼ºåˆ¶å‚ç›´æ’åˆ—ï¼Œå½»åº•è§£å†³é‡å é—®é¢˜ */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
            /* å¢åŠ é—´è· */
            gap: 20px;
            padding: 10px 0;
            box-sizing: border-box;
        }

        .my-turn-btn {
            background-color: #FF8A65; /* æŸ”å’Œçš„æ©™è‰² */
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 138, 101, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            /* ç¡®ä¿åœ¨å°å±å¹•ä¸Šä¸ä¼šå¤ªå¤§ */
            max-width: 80%;
            white-space: nowrap;
        }

        .my-turn-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 138, 101, 0.4);
            background-color: #FF7043;
        }

        .my-turn-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(255, 138, 101, 0.3);
        }

        .icon {
            font-size: 1.8rem;
        }

        /* æƒ…ç»ªå‹ç»§ç»­æŒ‰é’® */
        .continue-btn {
            /* ç§»é™¤ç»å¯¹å®šä½ï¼Œä½¿å…¶è‡ªç„¶ä½äºä¸‹æ–¹ */
            position: static;
            transform: none;
            margin: 0;
            
            background: none;
            border: none;
            color: #8D6E63;
            font-size: 1rem;
            cursor: pointer;
            opacity: 0; /* åˆå§‹éšè— */
            transition: opacity 1s ease;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 600px) {
            .interaction-area {
                min-height: 25vh; /* ç§»åŠ¨ç«¯å¯èƒ½éœ€è¦æ›´å¤šç©ºé—´ */
            }
            
            .my-turn-btn {
                padding: 12px 30px;
                font-size: 1.3rem;
            }
            
            .continue-btn {
                font-size: 0.9rem;
            }
        }
        
        .continue-btn.visible {
            opacity: 0.6;
        }
        
        .continue-btn:hover {
            opacity: 1 !important;
            color: #5D4037;
        }

        /* 5ï¸âƒ£ è¾…åŠ©æ§åˆ¶åŒºåŸŸï¼ˆä»…å®¶é•¿è§¦å‘ï¼‰ */
        .parents-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .parents-controls.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .controls-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .sub-btn {
            background: none;
            border: 1px solid #D7CCC8;
            color: #8D6E63;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .sub-btn.active {
            background-color: #8D6E63;
            color: white;
        }

        /* éšè—çš„å®¶é•¿è§¦å‘åŒº */
        .parent-trigger-area {
            position: fixed;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            z-index: 99;
            /* background: rgba(255,0,0,0.1); Debug only */
        }

        /* SVG æ ·å¼ */
        .svg-scene {
            width: 100%;
            height: 100%;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-height: 600px) {
            .visual-container { height: 60vh; }
            .interaction-area { height: 20vh; }
            .my-turn-btn { padding: 10px 30px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <!-- å®¶é•¿è§¦å‘åŒºåŸŸ (é•¿æŒ‰3ç§’) -->
    <div class="parent-trigger-area" id="parentTrigger"></div>

    <!-- å®¶é•¿æ§åˆ¶é¢æ¿ -->
    <div class="parents-controls" id="parentsControls">
        <div style="font-weight:bold; color:#5D4037; margin-bottom:5px;">Parents Only</div>
        <div class="parents-content">
            <p style="margin:2px 0;"><strong>Sent:</strong> <span id="parentSentence"></span></p>
            <p style="margin:2px 0;"><strong>CN:</strong> <span id="parentCN"></span></p>
        </div>
        <div class="controls-row">
            <button class="sub-btn" id="repeatBtn">Repeat</button>
            <button class="sub-btn" id="quietBtn">Quiet Mode</button>
            <button class="sub-btn" id="nextBtnParent">Next Page</button>
        </div>
    </div>

    <!-- 1ï¸âƒ£ ä¸»è§†è§‰åŒº -->
    <div class="visual-container">
        <!-- SVG æ’ç”»å®¹å™¨ -->
        <svg class="illustration" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
            <!-- èƒŒæ™¯å…‰æ™• -->
            <defs>
                <radialGradient id="glow" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                    <stop offset="0%" style="stop-color:#FFF3E0;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#FFF8F0;stop-opacity:0" />
                </radialGradient>
            </defs>
            <rect x="0" y="0" width="400" height="300" fill="url(#glow)" opacity="0.6" />

            <!-- åœ°é¢é›ªæ™¯ -->
            <path d="M0 250 Q 100 240, 200 250 T 400 250 L 400 300 L 0 300 Z" fill="#E1F5FE" />

            <!-- åœºæ™¯ç»„ï¼šé»˜è®¤éšè—ï¼Œé€šè¿‡ JS åˆ‡æ¢æ˜¾ç¤º -->
            
            <!-- Type: scene -->
            <g id="scene-scene" class="scene-group" style="display:none">
                <g transform="translate(100, 50)">
                    <rect x="90" y="200" width="20" height="30" fill="#795548" rx="2" />
                    <path d="M100 20 L 40 100 L 70 100 L 30 160 L 60 160 L 20 220 L 180 220 L 140 160 L 170 160 L 130 100 L 160 100 Z" fill="#81C784" rx="10" stroke="#66BB6A" stroke-width="2" stroke-linejoin="round" />
                    <circle cx="60" cy="120" r="6" fill="#FFCDD2" />
                    <circle cx="140" cy="140" r="6" fill="#BBDEFB" />
                    <circle cx="80" cy="180" r="7" fill="#FFF9C4" />
                    <circle cx="120" cy="200" r="6" fill="#E1BEE7" />
                    <circle cx="100" cy="80" r="5" fill="#FFCCBC" />
                    <polygon points="100,10 105,25 120,25 108,35 112,50 100,40 88,50 92,35 80,25 95,25" fill="#FFF176" />
                </g>
                <g transform="translate(220, 200)">
                    <rect x="0" y="20" width="50" height="40" fill="#FFAB91" rx="3" />
                    <rect x="20" y="20" width="10" height="40" fill="#FFCCBC" />
                    <rect x="0" y="35" width="50" height="10" fill="#FFCCBC" />
                    <path d="M25 20 L 25 10 Q 10 0, 25 20 Q 40 0, 25 20" fill="#FFCCBC" stroke="#FF8A65" stroke-width="2" />
                </g>
                <g transform="translate(80, 220)">
                    <rect x="0" y="10" width="40" height="30" fill="#90CAF9" rx="3" />
                    <rect x="18" y="10" width="4" height="30" fill="#E3F2FD" />
                    <rect x="0" y="22" width="40" height="4" fill="#E3F2FD" />
                </g>
            </g>

            <!-- Type: tree -->
            <g id="scene-tree" class="scene-group" style="display:none">
                <g transform="translate(140, 40) scale(1.2)">
                    <rect x="90" y="200" width="20" height="30" fill="#795548" rx="2" />
                    <path d="M100 20 L 40 100 L 70 100 L 30 160 L 60 160 L 20 220 L 180 220 L 140 160 L 170 160 L 130 100 L 160 100 Z" fill="#81C784" rx="10" stroke="#66BB6A" stroke-width="2" stroke-linejoin="round" />
                    <circle cx="60" cy="120" r="8" fill="#FFCDD2" />
                    <circle cx="140" cy="140" r="8" fill="#BBDEFB" />
                    <circle cx="80" cy="180" r="9" fill="#FFF9C4" />
                    <circle cx="120" cy="200" r="8" fill="#E1BEE7" />
                    <circle cx="100" cy="80" r="7" fill="#FFCCBC" />
                    <circle cx="50" cy="150" r="6" fill="#F06292" />
                    <circle cx="150" cy="180" r="6" fill="#4DB6AC" />
                    <polygon points="100,10 105,25 120,25 108,35 112,50 100,40 88,50 92,35 80,25 95,25" fill="#FFF176" />
                    <g transform="translate(180, 150) scale(0.6)">
                        <circle cx="0" cy="0" r="30" fill="#FFAB91" />
                        <rect x="-20" y="30" width="40" height="60" fill="#90CAF9" rx="10" />
                    </g>
                </g>
            </g>
            
            <!-- Type: tree-big (Reuse tree but bigger) -->
            <g id="scene-tree-big" class="scene-group" style="display:none">
                <g transform="translate(100, 20) scale(1.5)">
                    <rect x="90" y="200" width="20" height="30" fill="#795548" rx="2" />
                    <path d="M100 20 L 40 100 L 70 100 L 30 160 L 60 160 L 20 220 L 180 220 L 140 160 L 170 160 L 130 100 L 160 100 Z" fill="#81C784" rx="10" stroke="#66BB6A" stroke-width="2" stroke-linejoin="round" />
                    <circle cx="60" cy="120" r="8" fill="#FFCDD2" />
                    <circle cx="140" cy="140" r="8" fill="#BBDEFB" />
                    <circle cx="80" cy="180" r="9" fill="#FFF9C4" />
                    <circle cx="120" cy="200" r="8" fill="#E1BEE7" />
                    <circle cx="100" cy="80" r="7" fill="#FFCCBC" />
                    <polygon points="100,10 105,25 120,25 108,35 112,50 100,40 88,50 92,35 80,25 95,25" fill="#FFF176" />
                </g>
            </g>

            <!-- Type: beautiful-tree -->
            <g id="scene-beautiful-tree" class="scene-group" style="display:none">
                <g transform="translate(100, 50)">
                    <rect x="90" y="200" width="20" height="30" fill="#795548" rx="2" />
                    <path d="M100 20 L 40 100 L 70 100 L 30 160 L 60 160 L 20 220 L 180 220 L 140 160 L 170 160 L 130 100 L 160 100 Z" fill="#66BB6A" rx="10" stroke="#43A047" stroke-width="2" />
                    <circle cx="60" cy="120" r="6" fill="#FFF59D"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/></circle>
                    <circle cx="140" cy="140" r="6" fill="#FFF59D"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" begin="0.5s"/></circle>
                    <circle cx="80" cy="180" r="7" fill="#FFF59D"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" begin="1s"/></circle>
                    <circle cx="120" cy="200" r="6" fill="#FFF59D"><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" begin="1.5s"/></circle>
                    <polygon points="100,10 105,25 120,25 108,35 112,50 100,40 88,50 92,35 80,25 95,25" fill="#FFEB3B">
                        <animateTransform attributeName="transform" type="scale" values="1;1.2;1" dur="3s" repeatCount="indefinite" additive="sum" />
                    </polygon>
                </g>
            </g>

            <!-- Type: lights -->
            <g id="scene-lights" class="scene-group" style="display:none">
                <path d="M0,50 Q100,100 200,50 T400,50" fill="none" stroke="#5D4037" stroke-width="3" />
                <path d="M0,150 Q100,200 200,150 T400,150" fill="none" stroke="#5D4037" stroke-width="3" />
                <circle cx="50" cy="70" r="10" fill="#FF5252"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite"/></circle>
                <circle cx="150" cy="70" r="10" fill="#4CAF50"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="0.5s"/></circle>
                <circle cx="250" cy="70" r="10" fill="#2196F3"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="1s"/></circle>
                <circle cx="350" cy="70" r="10" fill="#FFEB3B"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="0.2s"/></circle>
                <circle cx="100" cy="170" r="10" fill="#AB47BC"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="0.7s"/></circle>
                <circle cx="200" cy="170" r="10" fill="#FF9800"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="1.2s"/></circle>
                <circle cx="300" cy="170" r="10" fill="#00BCD4"><animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite" begin="0.3s"/></circle>
            </g>

            <!-- Type: snow -->
            <g id="scene-snow" class="scene-group" style="display:none">
                <rect x="50" y="50" width="300" height="200" fill="#E1F5FE" stroke="#8D6E63" stroke-width="10" />
                <line x1="200" y1="50" x2="200" y2="250" stroke="#8D6E63" stroke-width="10" />
                <line x1="50" y1="150" x2="350" y2="150" stroke="#8D6E63" stroke-width="10" />
                <circle cx="150" cy="200" r="30" fill="white" />
                <circle cx="150" cy="160" r="20" fill="white" />
                <circle cx="145" cy="155" r="2" fill="black" />
                <circle cx="155" cy="155" r="2" fill="black" />
                <polygon points="150,160 160,165 150,170" fill="orange" />
                <circle cx="100" cy="100" r="5" fill="white"><animate attributeName="cy" from="50" to="250" dur="3s" repeatCount="indefinite"/></circle>
                <circle cx="250" cy="80" r="4" fill="white"><animate attributeName="cy" from="50" to="250" dur="4s" repeatCount="indefinite"/></circle>
                <circle cx="300" cy="120" r="6" fill="white"><animate attributeName="cy" from="50" to="250" dur="3.5s" repeatCount="indefinite"/></circle>
            </g>

            <!-- Type: santa -->
            <g id="scene-santa" class="scene-group" style="display:none">
                <g transform="translate(150, 80)">
                    <path d="M0,100 Q50,200 100,100 L100,50 Q50,-20 0,50 Z" fill="#D32F2F" />
                    <circle cx="50" cy="40" r="30" fill="#FFCCBC" />
                    <path d="M20,50 Q50,100 80,50 Q50,70 20,50" fill="white" />
                    <path d="M20,20 Q50,-30 80,20 L80,25 L20,25 Z" fill="#D32F2F" />
                    <circle cx="80" cy="20" r="8" fill="white" />
                    <circle cx="40" cy="35" r="3" fill="black" />
                    <circle cx="60" cy="35" r="3" fill="black" />
                    <circle cx="110" cy="80" r="10" fill="#FFCCBC">
                        <animate attributeName="cy" values="80;60;80" dur="1s" repeatCount="indefinite" />
                    </circle>
                </g>
            </g>

            <!-- Type: santa-laugh -->
            <g id="scene-santa-laugh" class="scene-group" style="display:none">
                <g transform="translate(150, 80) scale(1.2)">
                    <path d="M0,100 Q50,200 100,100 L100,50 Q50,-20 0,50 Z" fill="#D32F2F" />
                    <circle cx="50" cy="40" r="30" fill="#FFCCBC" />
                    <path d="M20,50 Q50,100 80,50 Q50,70 20,50" fill="white" />
                    <path d="M20,20 Q50,-30 80,20 L80,25 L20,25 Z" fill="#D32F2F" />
                    <circle cx="80" cy="20" r="8" fill="white" />
                    <path d="M35,35 Q40,30 45,35" fill="none" stroke="black" stroke-width="2" />
                    <path d="M55,35 Q60,30 65,35" fill="none" stroke="black" stroke-width="2" />
                    <path d="M40,55 Q50,65 60,55" fill="none" stroke="black" stroke-width="2" />
                    <text x="120" y="50" font-size="20" fill="#D32F2F">Ho Ho Ho!</text>
                </g>
            </g>

            <!-- Type: gifts -->
            <g id="scene-gifts" class="scene-group" style="display:none">
                <g transform="translate(100, 150)">
                    <rect x="0" y="50" width="60" height="50" fill="#EF5350" />
                    <rect x="25" y="50" width="10" height="50" fill="#FFEB3B" />
                    <rect x="0" y="70" width="60" height="10" fill="#FFEB3B" />
                    <rect x="70" y="30" width="70" height="70" fill="#42A5F5" />
                    <rect x="100" y="30" width="10" height="70" fill="#E3F2FD" />
                    <rect x="150" y="60" width="50" height="40" fill="#66BB6A" />
                    <rect x="170" y="60" width="10" height="40" fill="#A5D6A7" />
                </g>
            </g>

            <!-- Type: child-gift -->
            <g id="scene-child-gift" class="scene-group" style="display:none">
                <g transform="translate(150, 100)">
                    <circle cx="50" cy="30" r="25" fill="#FFAB91" />
                    <rect x="20" y="60" width="60" height="80" fill="#90CAF9" rx="10" />
                    <rect x="25" y="80" width="50" height="40" fill="#EF5350" />
                    <rect x="45" y="80" width="10" height="40" fill="#FFEB3B" />
                </g>
            </g>

            <!-- Type: happy-child -->
            <g id="scene-happy-child" class="scene-group" style="display:none">
                <g transform="translate(150, 80)">
                    <circle cx="50" cy="50" r="40" fill="#FFAB91" />
                    <circle cx="35" cy="40" r="4" fill="black" />
                    <circle cx="65" cy="40" r="4" fill="black" />
                    <path d="M30,60 Q50,80 70,60" fill="none" stroke="#D84315" stroke-width="3" />
                    <rect x="10" y="100" width="80" height="90" fill="#FFF59D" rx="15" />
                    <line x1="10" y1="120" x2="-20" y2="80" stroke="#FFAB91" stroke-width="8" stroke-linecap="round">
                        <animate attributeName="y2" values="80;70;80" dur="0.5s" repeatCount="indefinite" />
                    </line>
                    <line x1="90" y1="120" x2="120" y2="80" stroke="#FFAB91" stroke-width="8" stroke-linecap="round">
                        <animate attributeName="y2" values="80;70;80" dur="0.5s" repeatCount="indefinite" />
                    </line>
                </g>
            </g>

            <!-- Type: merry-christmas -->
            <g id="scene-merry-christmas" class="scene-group" style="display:none">
                <text x="200" y="100" text-anchor="middle" font-size="40" fill="#D32F2F" font-weight="bold" font-family="Comic Sans MS">Merry Christmas!</text>
                <g transform="translate(50, 150)">
                    <circle cx="30" cy="30" r="20" fill="#FFCCBC" />
                    <path d="M10,10 Q30,-20 50,10" fill="#D32F2F" />
                </g>
                <g transform="translate(150, 150)">
                    <path d="M25,0 L50,50 L0,50 Z" fill="#66BB6A" />
                </g>
                <g transform="translate(250, 150)">
                    <rect x="10" y="20" width="30" height="30" fill="#42A5F5" />
                </g>
            </g>

            <!-- é£˜è½çš„é›ªèŠ± -->
            <circle cx="50" cy="50" r="3" fill="#B3E5FC" opacity="0.6">
                <animate attributeName="cy" from="0" to="300" dur="10s" repeatCount="indefinite" />
                <animate attributeName="opacity" values="0;1;0" dur="10s" repeatCount="indefinite" />
            </circle>
            <circle cx="150" cy="20" r="2" fill="#B3E5FC" opacity="0.5">
                <animate attributeName="cy" from="-20" to="300" dur="12s" repeatCount="indefinite" delay="2s"/>
            </circle>
            <circle cx="250" cy="80" r="4" fill="#B3E5FC" opacity="0.4">
                <animate attributeName="cy" from="-50" to="300" dur="15s" repeatCount="indefinite" delay="5s"/>
            </circle>
            <circle cx="350" cy="40" r="2.5" fill="#B3E5FC" opacity="0.7">
                <animate attributeName="cy" from="-10" to="300" dur="8s" repeatCount="indefinite" delay="1s"/>
            </circle>

            <!-- æŸ”å’Œçš„ç¯å…‰æ•ˆæœ -->
            <circle cx="300" cy="100" r="50" fill="url(#glow)" opacity="0.4">
                <animate attributeName="opacity" values="0.3;0.6;0.3" dur="4s" repeatCount="indefinite" />
            </circle>
        </svg>
    </div>

    <!-- 4ï¸âƒ£ äº’åŠ¨æŒ‰é’® -->
    <div class="interaction-area">
        <button class="my-turn-btn" id="myTurnBtn">
            <span class="icon">ğŸ‘„</span> My Turn
        </button>
        
        <!-- æƒ…ç»ªå‹ç»§ç»­æŒ‰é’® -->
        <button class="continue-btn" id="continueBtn">
            Let's see more <span style="font-size:1.2em">â†’</span>
        </button>
    </div>

    <script>
        // æ•°æ®æºï¼šä» Hugo Frontmatter ä¼ é€’ç»™ JS
        const PAGES = [
            {{ range .Params.content_pages }}
            {
                sentence: "{{ .sentence }}",
                cn: "{{ .cn }}",
                type: "{{ .type }}"
            },
            {{ end }}
        ];

        // é…ç½®
        const AUTO_PLAY_INTERVAL = 15000; 
        const MY_TURN_PAUSE = 2500; 
        const AUTO_TRANSITION_DELAY = 30000; 
        const MIN_PLAY_COUNT = 2; 

        // çŠ¶æ€
        let currentIndex = 0;
        let isQuietMode = false;
        let autoPlayTimer = null;
        let isPlaying = false;
        let playCount = 0;
        let pageLoadTime = Date.now();
        let isTransitioning = false;
        
        // DOM å…ƒç´ 
        const illustration = document.querySelector('.illustration');
        const myTurnBtn = document.getElementById('myTurnBtn');
        const continueBtn = document.getElementById('continueBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const quietBtn = document.getElementById('quietBtn');
        const nextBtnParent = document.getElementById('nextBtnParent');
        const parentTrigger = document.getElementById('parentTrigger');
        const parentsControls = document.getElementById('parentsControls');
        const parentSentence = document.getElementById('parentSentence');
        const parentCN = document.getElementById('parentCN');
        const sceneGroups = document.querySelectorAll('.scene-group');

        // æ›´æ–°é¡µé¢å†…å®¹
        function updatePageContent() {
            const pageData = PAGES[currentIndex];
            
            // æ›´æ–°å®¶é•¿æ§åˆ¶åŒºæ–‡æœ¬
            parentSentence.textContent = pageData.sentence;
            parentCN.textContent = pageData.cn;
            
            // åˆ‡æ¢ SVG åœºæ™¯
            sceneGroups.forEach(group => group.style.display = 'none');
            const targetGroup = document.getElementById(`scene-${pageData.type}`);
            if (targetGroup) {
                targetGroup.style.display = 'block';
            } else {
                // Fallback to scene if not found
                const fallback = document.getElementById('scene-scene');
                if(fallback) fallback.style.display = 'block';
            }
            
            // é‡ç½®çŠ¶æ€
            playCount = 0;
            pageLoadTime = Date.now();
            continueBtn.classList.remove('visible');
            continueBtn.style.opacity = '0';
        }

        // é¡µé¢è·³è½¬å‡½æ•°ï¼ˆå•é¡µåˆ‡æ¢ï¼‰
        function navigateToNext() {
            if (isTransitioning) return;
            isTransitioning = true;
            
            // åœæ­¢æ‰€æœ‰éŸ³é¢‘å’Œè®¡æ—¶å™¨
            stopAutoPlayTimer();
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }

            // æ·¡å‡º
            document.body.classList.add('fading-out');
            
            setTimeout(() => {
                // åˆ‡æ¢æ•°æ®ç´¢å¼•
                currentIndex = (currentIndex + 1) % PAGES.length;
                updatePageContent();
                
                // æ·¡å…¥
                document.body.classList.remove('fading-out');
                
                // æ¢å¤è¿‡æ¸¡çŠ¶æ€å¹¶å¼€å§‹æ–°é¡µé¢çš„é€»è¾‘
                setTimeout(() => {
                    isTransitioning = false;
                    // è‡ªåŠ¨æ’­æ”¾
                    playAudio(PAGES[currentIndex].sentence, () => {
                        startAutoPlayTimer();
                    });
                }, 1000); // é…åˆ CSS transition 2s çš„ä¸€åŠï¼Œæˆ–ç­‰å¾… fade-out ç»“æŸ
                
            }, 2000); // ç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆ
        }

        // æ£€æŸ¥æ˜¯å¦æ»¡è¶³è‡ªåŠ¨è·³è½¬æ¡ä»¶
        function checkAutoTransition() {
            const timeStayed = Date.now() - pageLoadTime;
            if (timeStayed > AUTO_TRANSITION_DELAY && playCount >= MIN_PLAY_COUNT) {
                navigateToNext();
            }
        }

        // è¯­éŸ³åˆæˆè®¾ç½®
        function playAudio(text, callback) {
            if (!('speechSynthesis' in window)) {
                console.error("Speech Synthesis not supported");
                return;
            }

            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.85; 
            utterance.pitch = 1.0; 
            utterance.volume = 1.0;

            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(v => 
                (v.name.includes('Google') && v.name.includes('US') && v.name.includes('Female')) || 
                (v.name.includes('Samantha')) || 
                (v.name.includes('Victoria'))
            );
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }

            utterance.onstart = () => {
                isPlaying = true;
                illustration.classList.add('playing');
            };

            utterance.onend = () => {
                isPlaying = false;
                illustration.classList.remove('playing');
                playCount++;
                
                // æ’­æ”¾ä¸€æ¬¡åæ˜¾ç¤ºç»§ç»­æŒ‰é’®
                if (playCount >= 1) {
                    continueBtn.classList.add('visible');
                    continueBtn.style.opacity = '0.6';
                }
                
                // æ£€æŸ¥è‡ªåŠ¨è·³è½¬
                checkAutoTransition();
                
                if (callback) callback();
            };
            
            utterance.onerror = () => {
                isPlaying = false;
                illustration.classList.remove('playing');
            };

            window.speechSynthesis.speak(utterance);
        }

        // è‡ªåŠ¨æ’­æ”¾é€»è¾‘
        function startAutoPlayTimer() {
            if (isQuietMode) return;
            
            clearTimeout(autoPlayTimer);
            autoPlayTimer = setTimeout(() => {
                if (!isPlaying && !isQuietMode) {
                    playAudio(PAGES[currentIndex].sentence, () => {
                        startAutoPlayTimer();
                    });
                }
            }, AUTO_PLAY_INTERVAL);
        }

        function stopAutoPlayTimer() {
            clearTimeout(autoPlayTimer);
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // åˆå§‹åŒ–ç¬¬ä¸€é¡µå†…å®¹
            updatePageContent();
            document.body.classList.add('loaded');

            const initAudio = () => {
                setTimeout(() => {
                    playAudio(PAGES[currentIndex].sentence, () => {
                        startAutoPlayTimer();
                    });
                }, 1000);
            };

            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = () => {
                    initAudio();
                };
            } else {
                initAudio();
            }

            document.body.addEventListener('click', function initClick() {
                if (window.speechSynthesis.paused) {
                    window.speechSynthesis.resume();
                }
            }, { once: true });
            
            // å®šæœŸæ£€æŸ¥è‡ªåŠ¨è·³è½¬
            setInterval(checkAutoTransition, 5000);
        });

        // äº¤äº’é€»è¾‘
        myTurnBtn.addEventListener('click', () => {
            stopAutoPlayTimer();
            playAudio(PAGES[currentIndex].sentence, () => {
                setTimeout(() => {
                    playAudio(PAGES[currentIndex].sentence, () => {
                        startAutoPlayTimer();
                    });
                }, MY_TURN_PAUSE);
            });
        });

        continueBtn.addEventListener('click', () => {
            navigateToNext();
        });

        // å®¶é•¿æ§åˆ¶
        repeatBtn.addEventListener('click', () => {
            stopAutoPlayTimer();
            playAudio(PAGES[currentIndex].sentence, () => {
                startAutoPlayTimer();
            });
        });

        quietBtn.addEventListener('click', () => {
            isQuietMode = !isQuietMode;
            if (isQuietMode) {
                quietBtn.textContent = "Quiet Mode: On";
                quietBtn.classList.add('active');
                stopAutoPlayTimer();
            } else {
                quietBtn.textContent = "Quiet Mode: Off";
                quietBtn.classList.remove('active');
                startAutoPlayTimer();
            }
        });
        
        nextBtnParent.addEventListener('click', () => {
            navigateToNext();
        });

        // å®¶é•¿è§¦å‘é€»è¾‘ï¼šé•¿æŒ‰3ç§’
        let pressTimer;
        parentTrigger.addEventListener('mousedown', startPress);
        parentTrigger.addEventListener('touchstart', startPress);
        parentTrigger.addEventListener('mouseup', cancelPress);
        parentTrigger.addEventListener('touchend', cancelPress);
        parentTrigger.addEventListener('mouseleave', cancelPress);

        function startPress(e) {
            // e.preventDefault(); // é˜²æ­¢è§¦å‘å…¶ä»–ç‚¹å‡»
            pressTimer = setTimeout(() => {
                parentsControls.classList.toggle('visible');
            }, 3000);
        }

        function cancelPress() {
            clearTimeout(pressTimer);
        }

        document.addEventListener('click', () => {
            if (!isQuietMode) {
                startAutoPlayTimer();
            }
        });

    </script>
</body>
</html>
{{ end }}
