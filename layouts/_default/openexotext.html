<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenExoTest</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #2563EB;
            --success-color: #10B981;
            --bg-color: #F3F4F6;
            --card-bg: #FFFFFF;
            --text-color: #1F2937;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Hide global navigation */
        header, nav, .site-header, .site-navigation, footer, .top-navigation, .pv4, .bg-black-90, .ph3, .pv3, .ph4-m, .ph5-l {
            display: none !important;
        }

        .container {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        h1, h2 {
            text-align: center;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .hidden {
            display: none !important;
        }

        /* Input Styling */
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* Buttons */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.1s, opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background-color: #9CA3AF;
            margin-top: 10px;
        }

        /* Quiz Styling */
        .question-card {
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .options-grid {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: #F9FAFB;
            border: 2px solid #E5E7EB;
            padding: 15px;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .option-btn:hover {
            border-color: var(--primary-color);
            background: #EFF6FF;
        }

        .option-btn.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #E5E7EB;
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Result Styling */
        .result-score {
            font-size: 4rem;
            font-weight: 800;
            text-align: center;
            color: var(--primary-color);
            margin: 1rem 0;
        }

        .result-badge {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            margin-bottom: 2rem;
        }

        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }

        .badge-normal {
            background: #F3F4F6;
            color: #4B5563;
        }

        .history-list {
            margin-top: 20px;
            text-align: left;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        
        .error-msg {
            color: #EF4444;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>

    <!-- Step 1: Input ID -->
    <div id="step-login" class="container">
        <h1>🚀 OpenExoText</h1>
        <p style="text-align: center; color: #666; margin-bottom: 2rem;">请输入您的唯一 ID 以开始评测</p>
        
        <input type="text" id="userIdInput" placeholder="请输入数字或字母组合的 ID" maxlength="20">
        <p id="loginError" class="error-msg">请输入有效的 ID</p>
        
        <button class="btn" onclick="handleLogin()">下一步</button>
        
        <div id="existingUserOptions" class="hidden" style="margin-top: 20px;">
            <p style="text-align: center; color: #666;">检测到该 ID 已有记录</p>
            <button class="btn" onclick="showHistory()">查看历史结果</button>
            <button class="btn btn-secondary" onclick="startNewTest()">重新测试 (覆盖旧数据)</button>
        </div>
    </div>

    <!-- Step 2: Intro -->
    <div id="step-intro" class="container hidden">
        <h2>指数商测试</h2>
        <div style="line-height: 1.6; color: #4B5563; margin-bottom: 2rem;">
            <p><strong>测试说明：</strong> 本问卷用于测试你所在公司的“指数化”程度，共有25个问题，每题有4个选项。</p>
            <p><strong>计分规则：</strong> 你选择的选项标号是几就计几分，比如你选择标号为2的选项，该题的得分就是2分。做完全部25题后，系统将自动计算总分。</p>
            <p><strong>结果解读：</strong> 测试满分为100分，总分超过66分就可以认为是指数型组织。分数越高，说明你所在公司具备的指数型特征越突出，竞争力越强！</p>
            <p>选出最符合公司状态的选项，测测你所在公司的指数商是多少吧！</p>
        </div>
        <button class="btn" onclick="startQuiz()">开始测试</button>
    </div>

    <!-- Step 3: Quiz -->
    <div id="step-quiz" class="container hidden">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div id="questionContainer">
            <!-- Questions injected via JS -->
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" style="display:none">上一题</button>
            <button class="btn" id="nextBtn" onclick="nextQuestion()">下一题</button>
        </div>
    </div>

    <!-- Step 4: Result -->
    <div id="step-result" class="container hidden">
        <h2>评测结果</h2>
        <div id="scoreDisplay" class="result-score">0</div>
        <div id="resultBadge" class="result-badge"></div>
        <div id="resultMessage" style="text-align: center; color: #666; margin-bottom: 2rem;"></div>
        
        <button class="btn" onclick="location.reload()">退出 / 切换账号</button>
    </div>

    <!-- History View -->
    <div id="step-history" class="container hidden">
        <h2>历史记录</h2>
        <div id="historyContent" style="margin-bottom: 20px;"></div>
        <button class="btn" onclick="startNewTest()">重新测试</button>
        <button class="btn btn-secondary" onclick="location.reload()">退出</button>
    </div>

    <!-- Netlify Form (Hidden) -->
    <form name="exo-results" method="POST" action="/openexotest/" netlify netlify-honeypot="bot-field" hidden>
        <input type="text" name="userId" />
        <input type="text" name="score" />
        <input type="text" name="answers" />
        <textarea name="details"></textarea>
    </form>

    <script>
        // Data Structure
        const QUESTIONS = [
            // 人力资源和资产管理
            { 
                text: "1. 公司在全职员工和随需随聘的员工之间如何取舍？", 
                options: [
                    "我们只雇用全职员工。", 
                    "我们主要雇用全职员工，在非关键任务上会雇用一些随需随聘的员工，例如技术外包、临时生产等环节。", 
                    "我们在关键任务上会雇用一些随需随聘的员工，例如运营、生产、人力资源等环节。", 
                    "我们主要雇用随需随聘的员工，除此之外，我们只有一支小规模的全职核心团队。"
                ] 
            },
            { 
                text: "2. 公司实现商业功能时利用了多少外部资源？", 
                options: [
                    "大部分商业功能都是由内部员工处理的。", 
                    "我们会将一部分行政和支持功能外包出去，例如应付账款(AP)、应收账款(AR)、技术支持、设施等。", 
                    "我们会将一些关键业务外包出去，就如苹果与富士康的关系。", 
                    "我们强调敏捷，就连关键业务都是以可变成本形式外包的，而非固定成本外包。"
                ] 
            },
            { 
                text: "3. 公司拥有的自有资产和租赁资产之间的比例如何？", 
                options: [
                    "除了外围设备（例如复印机），所有的资产都是公司所有的。", 
                    "我们会按需租用一些关键性的设备或服务，例如云计算。", 
                    "我们在多种商业功能中使用按需租用的资产，例如采用共享办公室。", 
                    "我们在关键业务中也会使用按需租用的资产。"
                ] 
            },
            // 社群与大众
            { 
                text: "4. 公司管理社群（用户、客户、合伙人、粉丝）及与之交互的程度如何？", 
                options: [
                    "我们与社群的互动非常被动，仅仅使用某些社交媒体。", 
                    "我们利用社群进行市场调查和其他听取民意的活动。", 
                    "我们积极地使用社群进行服务扩张、产品支持和市场营销。", 
                    "社群对我们公司有很深的影响，例如在产品创意、产品开发中扮演重要的角色。"
                ] 
            },
            { 
                text: "5. 公司如何与社群接触？", 
                options: [
                    "除了标准的客户服务就没有接触了。", 
                    "我们的社群是中心化的，交流方式是“一对多”的，例如TED.com和苹果。", 
                    "我们的社群是去中心化的，交流方式是“多对多”的，但其目标是被动且单一的，例如领英和Facebook。", 
                    "我们的社群是去中心化的，交流方式是“多对多”的，并鼓励点对点的价值创造，例如维基百科。"
                ] 
            },
            // 参与社群与大众
            { 
                text: "6. 公司是否会主动将“大众”转变成社群成员？", 
                options: [
                    "我们使用标准方法来增加关注度。", 
                    "我们使用社交媒体来进行市场营销。", 
                    "我们使用游戏化和大奖赛来将大众转变成社群成员。", 
                    "我们的产品和服务本身的设计目的就是将大众转变成社群成员。"
                ] 
            },
            { 
                text: "7. 公司利用游戏化或大奖赛的程度如何？", 
                options: [
                    "我们只在内部激励时使用游戏化或大奖赛，例如月度销售之星。", 
                    "我们对外部使用基本的游戏化方法，例如老客户优惠、航空公司的VIP乘客。", 
                    "我们在产品和服务中融入了游戏化或大奖赛。", 
                    "我们利用游戏化或大奖赛来促进创意构思和产品开发。"
                ] 
            },
            // 运用信息和社交功能
            { 
                text: "8. 公司的产品和服务基于信息的程度如何？", 
                options: [
                    "我们的产品和服务本质上是基于物质的，例如星巴克或者大部分传统的零售商。", 
                    "我们的产品和服务是物质的，但其配送和生产是基于信息的，例如亚马逊。", 
                    "我们的产品和服务是物质的，但服务是基于信息的，且公司收益主要来源于服务，例如手机应用商店。", 
                    "我们的产品和服务完全是基于信息的，例如领英。"
                ] 
            },
            { 
                text: "9. 社交功能和协作在公司的产品和服务的价值中是否占据核心地位？", 
                options: [
                    "在我们的产品和服务中并没有设计任何社交或协作内容。", 
                    "我们在现有的产品和服务上添加了社交或协作结构。", 
                    "我们利用社交或协作功能来增强或体现产品和服务的价值。", 
                    "社交或协作的输入其实是我们产品和服务价值的基础。"
                ] 
            },
            // 数据和算法
            { 
                text: "10. 公司运用算法和机器学习来进行决策的程度如何？", 
                options: [
                    "我们不进行任何有意义的数据分析。", 
                    "我们主要通过汇报系统收集和分析数据。", 
                    "我们使用机器学习算法来分析数据和推动可执行的决策。", 
                    "我们的产品和服务是围绕算法和机器学习建立起来的，例如利用搜索引擎。"
                ] 
            },
            { 
                text: "11. 公司是否在内部完全共享战略数据资产或者对外部社区开放战略数据资产？", 
                options: [
                    "在不同部门之间，我们不共享数据。", 
                    "我们在不同部门之间共享数据。", 
                    "我们将一些数据开放给关键的供应商。", 
                    "我们通过开放应用程序编程接口将一些数据开放给外部生态系统。"
                ] 
            },
            // 用户界面和可扩展过程
            { 
                text: "12. 公司是否拥有专门的流程来管理内部组织的外界因素的产出？", 
                options: [
                    "我们不利用外部因素，没有专门的流程去获取或管理外部因素。", 
                    "我们有专门的员工来管理外部因素。", 
                    "我们有自动的流程来管理某一外部因素。", 
                    "我们有自动的流程来管理多项外部因素。"
                ] 
            },
            { 
                text: "13. 在公司核心部门之外的关键流程的可复制性和可扩展性如何？", 
                options: [
                    "我们拥有传统的、大多手动的流程。", 
                    "我们的一部分流程是可扩展和可重复的，但只限于公司内部。", 
                    "我们的一部分流程是在公司外部处理的。", 
                    "大部分核心流程都是自给自足的，可通过可扩展平台在公司外部执行。"
                ] 
            },
            // 实时仪表盘和员工管理
            { 
                text: "14. 公司根据什么指标来跟踪内部和产品创新名录的状态？例如精益创业(Lean Startup)分析法。", 
                options: [
                    "我们只跟踪月度、季度或年度的传统关键绩效指标，例如销量、成本、利润。", 
                    "我们从交易系统中收集一些实时的、传统的指标，例如企业资源计划。", 
                    "我们收集各种各样的实时、传统的指标，并使用一些精益创业的指标。", 
                    "我们收集实时的传统指标和精益创业（价值和学习）指标。"
                ] 
            },
            { 
                text: "15. 你是否使用一些目标与关键成果评价法的变形来跟踪个人和团队的业绩？", 
                options: [
                    "不，我们使用传统的季度或月度业绩报告、360度报告或员工排名。", 
                    "我们在创新领域或公司边缘采用了目标与关键成果评价法。", 
                    "我们公司上上下下都采用了目标与关键成果评价法，例如领英。", 
                    "我们公司上上下下都采用了完全透明的目标与关键成果评价法。例如，谷歌公司的每个人都能查看别人的业绩。"
                ] 
            },
            // 实验和风险
            { 
                text: "16. 公司是否不断通过实验、产品双向测试和短周期反馈回路来优化流程？", 
                options: [
                    "我们使用传统的商业流程管理。", 
                    "我们在面向客户的领域使用精益方法。", 
                    "我们在产品创新和产品开发中使用精益方法。", 
                    "我们在所有核心功能中都使用精益方法，包括创新、市场营销、销售、服务、人力资源及法律。"
                ] 
            },
            { 
                text: "17. 公司容忍失败和鼓励冒险的程度如何？", 
                options: [
                    "我们不允许失败，失败是可能丢饭碗的。", 
                    "我们鼓励失败和冒险，但只是喊口号，并没有进行跟踪或量化。", 
                    "我们允许失败和冒险，但只是在非常有限的范围内。", 
                    "失败和冒险在我们公司是家常便饭，我们甚至会衡量失败乃至庆祝失败，例如亚马逊、谷歌、宝洁的“英雄失败奖”。"
                ] 
            },
            // 自治和去中心化
            { 
                text: "18. 公司是由庞大的阶层式结构运作，还是由小型的多流程自我管理的团队组成的？", 
                options: [
                    "我们拥有传统的公司阶层，严格按照大型的专门群组来运作。", 
                    "我们在核心之外的边缘拥有一些小型的多流程团队。", 
                    "我们在核心内部接受并欢迎一些小型的多流程团队。", 
                    "我们公司的基本运营结构是多流程、互联、自我管理的小型团队。"
                ] 
            },
            { 
                text: "19. 公司在管理和决策过程中，去中心化的程度如何？", 
                options: [
                    "公司使用传统的、自上而下的命令与控制体系。", 
                    "在研发、创新和产品开发中采用去中心化的决策方法。", 
                    "在所有面向客户的领域，例如市场营销、销售等，采用去中心化的决策方法。", 
                    "所有的关键决策都是去中心化的，除了企业目标、战略、文化等方面。"
                ] 
            },
            // 社交技术和社交企业
            { 
                text: "20. 公司内部是否使用高级的社交工具进行知识共享、交流、沟通或协作，例如使用微信、钉钉、印象笔记等工具。", 
                options: [
                    "公司内部不使用社交工具，电子邮件是主要的沟通工具。", 
                    "一些团队会使用社交工具，但并没有在公司内部全面普及。", 
                    "在与外界沟通时多使用社交工具，不过通常是未经许可的。", 
                    "全公司广泛使用社交工具，这是整个公司必须遵循的原则之一。"
                ] 
            },
            { 
                text: "21. 公司的使命是什么？", 
                options: [
                    "我们的使命是专注于提供最好的产品和服务。", 
                    "我们的使命不只是关注产品和服务，我们的企业拥有核心价值观。", 
                    "我们的使命并不局限于服务终极客户，我们的目标是为经销商、合作伙伴、供应商和包括员工在内的整个生态系统带来积极的改变。", 
                    "我们拥有超越任务宣言的变革目标，我们致力于为全世界带来重大改变。"
                ] 
            },
            // 设计思维
            { 
                text: "22. 你的组织在多大程度上运用了设计思维？", 
                options: [
                    "我们在组织内的任何方面都是以产品或技术为中心，而非以设计为中心。", 
                    "我们在产品功能开发中运用设计思维。", 
                    "我们在创新领域以及整个产品开发过程中运用设计思维（在内部和外部使用，不仅用于产品，也用于组织自身）。", 
                    "我们不仅在产品方面，而且在整个组织以及组织自身的发展中都运用设计思维。"
                ] 
            },
            // 平台
            { 
                text: "23. 你的组织是否在努力成为一个平台，或者你的组织在多大程度上已经是一个平台？", 
                options: [
                    "我们的产品线是孤立的，没有平台可言。", 
                    "我们的产品和服务形成了一个天然的平台，但是只面向内部。", 
                    "我们就是一个平台。", 
                    "我们的核心目标是成为一个平台，让供应商和消费者都能自行配置资源。"
                ] 
            },
            // 应对变化的能力和创新
            { 
                text: "24. 你的组织的免疫系统有多强？", 
                options: [
                    "总体而言，我们的组织非常抗拒变革，常常将其视为地位和影响力范围的丧失。", 
                    "我们被允许进行实验和新的构思，但对失败的抗拒会使新想法的实施变得困难。", 
                    "我们的公司内部采用了颠覆性思维，但这没有成为我们的工作方式。", 
                    "我们的组织创造了一种依靠变革和创新来生存的文化，这是组织DNA的一部分。"
                ] 
            },
            { 
                text: "25. 在你的组织中，创新工作由哪个部门负责？", 
                options: [
                    "根据公司商定好的预算在每个业务部门内部进行。", 
                    "我们有一个独立于其他领域的创新部门。", 
                    "我们有一个孵化器（或与一个孵化器合作）来进行创新。", 
                    "我们在不同的业务部门都有这样的创新孵化器。"
                ] 
            }
        ];

        // State
        let currentUserId = '';
        let currentQuestionIndex = 0;
        let userAnswers = {}; // { index: score }
        
        // --- Step 1: Login Logic ---
        function handleLogin() {
            const id = document.getElementById('userIdInput').value.trim();
            const errorEl = document.getElementById('loginError');
            
            if (!id) {
                errorEl.style.display = 'block';
                return;
            }
            errorEl.style.display = 'none';
            currentUserId = id;

            // Check LocalStorage
            const savedData = localStorage.getItem('exo_user_' + id);
            if (savedData) {
                document.getElementById('existingUserOptions').classList.remove('hidden');
                document.querySelector('#step-login .btn').style.display = 'none'; // Hide Next button
            } else {
                showStep('intro');
            }
        }

        function startNewTest() {
            userAnswers = {};
            currentQuestionIndex = 0;
            showStep('intro');
        }

        function showHistory() {
            const data = JSON.parse(localStorage.getItem('exo_user_' + currentUserId));
            const container = document.getElementById('historyContent');
            
            let html = `<p><strong>上次得分：</strong> ${data.score}</p>`;
            html += `<p><strong>评级：</strong> ${data.score > 66 ? '指数型组织 🚀' : '传统/转型中组织 🏢'}</p>`;
            html += `<p><strong>测试时间：</strong> ${new Date(data.timestamp).toLocaleString()}</p>`;
            
            container.innerHTML = html;
            showStep('history');
        }

        // --- Step 2 & 3: Quiz Logic ---
        function startQuiz() {
            showStep('quiz');
            renderQuestion();
        }

        function renderQuestion() {
            const q = QUESTIONS[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            // Update Progress
            const progress = ((currentQuestionIndex) / QUESTIONS.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;

            // Render
            let html = `<div class="question-card">
                <div class="question-text">问题${currentQuestionIndex + 1}：${q.text.replace(/^\d+\.\s*/, '')}</div>
                <div class="options-grid">`;
            
            q.options.forEach((opt, idx) => {
                const score = idx + 1;
                const isSelected = userAnswers[currentQuestionIndex] === score ? 'selected' : '';
                html += `<div class="option-btn ${isSelected}" onclick="selectOption(${score})">${opt}</div>`;
            });
            
            html += `</div></div>`;
            container.innerHTML = html;

            // Buttons
            document.getElementById('prevBtn').style.display = currentQuestionIndex === 0 ? 'none' : 'block';
            document.getElementById('nextBtn').innerText = currentQuestionIndex === QUESTIONS.length - 1 ? '提交' : '下一题';
        }

        function selectOption(score) {
            userAnswers[currentQuestionIndex] = score;
            renderQuestion(); // Re-render to show selection
        }

        function nextQuestion() {
            if (!userAnswers[currentQuestionIndex]) {
                alert("请先选择一个选项");
                return;
            }

            if (currentQuestionIndex < QUESTIONS.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                submitQuiz();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        // --- Step 4: Submit & Result ---
        function submitQuiz() {
            // Calculate Score
            let totalScore = 0;
            Object.values(userAnswers).forEach(s => totalScore += s);

            // Save to LocalStorage
            const resultData = {
                id: currentUserId,
                score: totalScore,
                answers: userAnswers,
                timestamp: Date.now()
            };
            localStorage.setItem('exo_user_' + currentUserId, JSON.stringify(resultData));

            // Send to Netlify Form
            sendToNetlify(resultData);

            // Show Result
            showStep('result');
            document.getElementById('scoreDisplay').innerText = totalScore;
            
            const badgeEl = document.getElementById('resultBadge');
            const msgEl = document.getElementById('resultMessage');

            if (totalScore > 66) {
                badgeEl.innerText = "🚀 您的组织是指数型组织！";
                badgeEl.className = "result-badge badge-success";
                msgEl.innerText = "恭喜！您的组织具备强大的指数级增长潜力。";
                triggerFireworks();
            } else {
                badgeEl.innerText = "🏢 您的组织处于传统或转型阶段";
                badgeEl.className = "result-badge badge-normal";
                msgEl.innerText = "您还有很大的提升空间，建议关注 ExO 的核心属性进行改进。";
            }
        }

        function sendToNetlify(data) {
            const formData = new FormData();
            formData.append('form-name', 'exo-results');
            formData.append('userId', data.id);
            formData.append('score', data.score);
            formData.append('answers', JSON.stringify(data.answers));
            formData.append('details', `Timestamp: ${new Date(data.timestamp).toISOString()}`);

            // Post to the current page URL to avoid 404s
            fetch('/openexotest/', {
                method: 'POST',
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams(formData).toString()
            })
            .then(() => console.log('Form successfully submitted'))
            .catch(error => console.error('Submission error:', error));
        }

        function triggerFireworks() {
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            const random = (min, max) => Math.random() * (max - min) + min;

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // --- Helpers ---
        function showStep(stepName) {
            ['login', 'intro', 'quiz', 'result', 'history'].forEach(s => {
                document.getElementById('step-' + s).classList.add('hidden');
            });
            document.getElementById('step-' + stepName).classList.remove('hidden');
        }
    </script>
</body>
</html>
